<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سيرة ذاتية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- إضافة مكتبة jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- إضافة خطوط عربية متنوعة -->
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Changa:wght@200;300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Reem+Kufi:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Markazi+Text:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lateef:wght@200;300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Mada:wght@200;300;400;500;600;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Baloo+Bhaijaan+2:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Aref+Ruqaa:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Jomhuria&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE'
                    },
                    fontFamily: {
                        'tajawal': ['Tajawal', 'sans-serif'],
                        'almarai': ['Almarai', 'sans-serif'],
                        'cairo': ['Cairo', 'sans-serif'],
                        'changa': ['Changa', 'sans-serif'],
                        'elmessiri': ['El Messiri', 'sans-serif'],
                        'amiri': ['Amiri', 'serif'],
                        'reemkufi': ['Reem Kufi', 'sans-serif'],
                        'markazi': ['Markazi Text', 'serif'],
                        'scheherazade': ['Scheherazade New', 'serif'],
                        'lateef': ['Lateef', 'cursive'],
                        'mada': ['Mada', 'sans-serif'],
                        'baloo': ['Baloo Bhaijaan 2', 'cursive'],
                        'ibmplexarabic': ['IBM Plex Sans Arabic', 'sans-serif'],
                        'notokufi': ['Noto Kufi Arabic', 'sans-serif'],
                        'arefruqaa': ['Aref Ruqaa', 'serif'],
                        'jomhuria': ['Jomhuria', 'cursive']
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@200;300;400;500;700;800;900&display=swap');
        
        :root {
            --font-family: 'Tajawal', sans-serif;
            --font-size-base: 1rem;
            --font-size-header: 2rem;
            --font-size-title: 1.25rem;
            --font-size-subtitle: 1.1rem;
            --font-weight-normal: 400;
            --font-weight-bold: 700;
            --line-height: 1.5;
            --bullet-type: '•'; /* إضافة متغير للنقطة الافتراضية */
        }
        
        body {
            font-family: var(--font-family);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-normal);
            line-height: var(--line-height);
        }
        
        #personName {
            font-size: var(--font-size-header);
            font-weight: var(--font-weight-bold);
            text-align: center;
            direction: rtl;
            unicode-bidi: embed;
            width: 100%;
            margin: 0 auto;
            position: relative;
        }
        
        .section-header h2 {
            font-size: var(--font-size-title);
            font-weight: var(--font-weight-bold);
        }
        
        [contenteditable="true"] {
            border: 1px dashed var(--primary-color, #5D5CDE);
            padding: 5px;
            border-radius: 5px;
            min-height: 1.5rem;
        }
        
        [contenteditable="true"]:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(var(--primary-rgb, 93, 92, 222), 0.3);
        }
        
        .custom-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        
        .custom-list li {
            position: relative;
            padding-right: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: flex-start;
            margin-bottom: 0.5rem;
            padding: 0.25rem 1.5rem 0.25rem 0.25rem;
            transition: background-color 0.2s;
        }
        
        .custom-list li:before {
            content: var(--bullet-type, '•');
            position: absolute;
            right: 0;
            color: var(--primary-color, #5D5CDE);
            font-weight: bold;
        }
        
        .delete-btn {
            visibility: hidden;
            opacity: 0;
            transition: all 0.2s;
            cursor: pointer;
            color: #e53e3e;
            margin-right: 5px;
            font-size: 14px;
        }
        
        /* تحسين ظهور زر الحذف في وضع التحرير */
        .edit-mode .custom-list li .delete-btn {
            visibility: visible;
            opacity: 0.6;
        }
        
        .edit-mode .custom-list li:hover .delete-btn {
            opacity: 1;
        }
        
        /* تنسيق زر حذف القسم */
        .section-delete-btn {
            visibility: hidden;
            opacity: 0;
            transition: all 0.2s;
            cursor: pointer;
            color: #e53e3e;
            margin-right: 5px;
            font-size: 16px;
        }
        
        .edit-mode .section-header:hover .section-delete-btn {
            visibility: visible;
            opacity: 1;
        }
        
        /* تنسيق مقبض السحب للقسم */
        .section-drag-handle {
            visibility: hidden;
            opacity: 0;
            transition: all 0.2s;
            cursor: move;
            color: var(--primary-color, #5D5CDE);
            margin-right: 5px;
            font-size: 16px;
        }
        
        .edit-mode .section-header:hover .section-drag-handle {
            visibility: visible;
            opacity: 1;
        }
        
        /* تنسيق قسم قابل للسحب */
        .draggable-section {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .edit-mode .draggable-section {
            position: relative;
        }
        
        .draggable-section.dragging {
            opacity: 0.5;
            box-shadow: 0 0 15px rgba(var(--primary-rgb, 93, 92, 222), 0.3);
            z-index: 10;
        }
        
        /* منطقة الإسقاط */
        .drop-indicator {
            height: 5px;
            background-color: var(--primary-color, #5D5CDE);
            margin: 10px 0;
            border-radius: 2px;
            display: none;
        }
        
        /* إضافة تأثير عند المرور فوق العناصر القابلة للحذف */
        .edit-mode .custom-list li:hover {
            background-color: rgba(var(--primary-rgb, 93, 92, 222), 0.05);
            border-radius: 4px;
        }
        
        .edit-mode .section-header:hover {
            background-color: rgba(var(--primary-rgb, 93, 92, 222), 0.05);
            border-radius: 4px;
        }
        
        .bg-primary-custom {
            background-color: var(--primary-color, #5D5CDE);
        }
        
        .text-primary-custom {
            color: var(--primary-color, #5D5CDE);
        }
        
        .bg-custom {
            background-color: var(--background-color, #FFFFFF);
        }
        
        .text-custom {
            color: var(--text-color, #1F2937);
        }
        
        .color-option {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #fff;
            box-shadow: 0 0 2px rgba(0,0,0,0.3);
            transition: transform 0.2s;
            margin: 0 4px;
        }
        
        .color-option:hover {
            transform: scale(1.2);
        }
        
        .color-option.active {
            transform: scale(1.2);
            border: 2px solid #333;
            box-shadow: 0 0 4px rgba(0,0,0,0.5);
        }
        
        .color-picker-container {
            display: flex;
            align-items: center;
            margin-right: 10px;
            margin-bottom: 0.5rem;
        }
        
        .color-picker-panel, .font-picker-panel, .bullet-picker-panel {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 12px;
            margin-top: 10px;
            position: absolute;
            top: 100%;
            right: 0;
            width: 330px;
            z-index: 50;
            max-height: 85vh;
            overflow-y: auto;
        }
        
        .border-custom {
            border-color: var(--border-color, #E5E7EB);
        }
        
        /* تنسيق أزرار الإضافة الجديدة */
        .add-item-btn, .add-section-btn {
            font-size: 14px;
            color: var(--primary-color, #5D5CDE);
            background-color: transparent;
            border: 1px dashed var(--primary-color, #5D5CDE);
            padding: 2px 8px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 8px;
            transition: all 0.2s;
            display: none;
        }
        
        .edit-mode .add-item-btn, .edit-mode .add-section-btn {
            display: inline-block;
        }
        
        .add-item-btn:hover, .add-section-btn:hover {
            background-color: rgba(var(--primary-rgb, 93, 92, 222), 0.1);
        }
        
        /* تنسيق حوار إضافة قسم جديد */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        /* لودر لعرض حالة التحميل */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color, #5D5CDE);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* تنسيق اختيار نماذج */
        .template-option {
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
        }
        
        .template-option.active {
            border-color: var(--primary-color, #5D5CDE);
            background-color: rgba(var(--primary-rgb, 93, 92, 222), 0.05);
        }
        
        .template-option:hover {
            border-color: var(--primary-color, #5D5CDE);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .template-categories {
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
            padding-bottom: 10px;
            margin-bottom: 15px;
            -webkit-overflow-scrolling: touch;
        }
        
        .template-category {
            display: inline-block;
            padding: 6px 12px;
            margin-left: 10px;
            border-radius: 20px;
            background-color: #F3F4F6;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .template-category.active {
            background-color: var(--primary-color, #5D5CDE);
            color: white;
        }
        
        /* التنسيقات المتعلقة بالإعداد للطباعة */
        @media print {
            .no-print {
                display: none !important;
            }
            
            /* إعدادات لتناسب الصفحة الواحدة */
            html, body {
                height: 100%;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            .custom-list li {
                break-inside: avoid;
            }
        }
        
        /* توسيط أزرار الإضافة */
        .section-buttons {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        /* تنسيق خاص للقسم الرئيسي الجديد */
        .custom-section {
            margin-bottom: 2rem;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* تنسيق لإظهار الأقسام القابلة للسحب */
        .edit-mode .draggable-section {
            padding: 10px;
            border-radius: 6px;
            border: 1px dashed transparent;
            transition: border-color 0.2s;
        }
        
        .edit-mode .draggable-section:hover {
            border-color: var(--primary-color, #5D5CDE);
        }

        /* تنسيق لوحة اختيار شكل النقاط */
        .bullet-option {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            margin: 5px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 20px;
            border: 2px solid #e5e7eb;
            transition: all 0.2s;
            background-color: white;
        }
        
        .bullet-option:hover {
            background-color: #f3f4f6;
            transform: scale(1.1);
        }
        
        .bullet-option.active {
            border-color: var(--primary-color, #5D5CDE);
            background-color: rgba(var(--primary-rgb, 93, 92, 222), 0.05);
            box-shadow: 0 2px 6px rgba(var(--primary-rgb, 93, 92, 222), 0.2);
        }
        
        .bullet-options-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 10px;
        }

        /* تنسيقات متنوعة للنقاط */
        .bullet-type-normal .custom-list li:before { content: '•'; }
        .bullet-type-diamond .custom-list li:before { content: '◆'; }
        .bullet-type-triangle .custom-list li:before { content: '►'; }
        .bullet-type-check .custom-list li:before { content: '✓'; }
        .bullet-type-star .custom-list li:before { content: '✦'; }
        .bullet-type-square .custom-list li:before { content: '■'; }
        .bullet-type-circle .custom-list li:before { content: '◉'; }
        .bullet-type-arrow .custom-list li:before { content: '➤'; }
        .bullet-type-dash .custom-list li:before { content: '--'; }
        .bullet-type-plus .custom-list li:before { content: '+'; }
        .bullet-type-heart .custom-list li:before { content: '♥'; }
        .bullet-type-rarrow .custom-list li:before { content: '❯'; }
        
        /* تنسيقات نماذج ATS المختلفة */
/* ATS Executive - مخصص للمناصب التنفيذية والإدارية العليا */
/* الحاوية الرئيسية للتخطيط باستخدام flex */
.template-ats-executive #personName {
    font-size: 2.2rem;
    font-weight: 700;
    line-height: 1.3;
    font-family: 'Amiri', serif;
    margin: 10px 0 30px; /* زيادة المسافة السفلية هنا */
    position: relative;
    padding-bottom: 15px; /* إضافة مسافة داخلية من الأسفل */
}

.template-ats-executive #personName::after {
    content: "";
    display: block;
    width: 60px;
    height: 3px;
    background: var(--primary-color, #5D5CDE);
    position: absolute;
    bottom: 0;
    right: 50%;
    transform: translateX(50%);
    margin-top: 15px; /* مسافة إضافية بعد الخط */
}

.template-ats-executive .header-text {
    margin-top: 1.5rem; /* مسافة فوق النص الفرعي */
    padding-top: 1rem; /* مسافة داخلية من الأعلى */
}

        /* ATS Minimalist - نموذج بسيط وأنيق مع تركيز على المحتوى */
        .template-ats-executive .resume-header {
      padding: 15px 25px;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      border-bottom: 2px solid var(--primary-color, #5D5CDE);
    }
    
    /* العنصر المخصص للنص العربي */
    .template-ats-executive .header-text {
      width: 100%;
      text-align: right;
      direction: rtl;
      font-family: 'Tajawal', 'Cairo', 'Amiri', Arial, sans-serif;
    }

        /* ATS Modern - للشركات الحديثة والمؤسسات التكنولوجية */
        .template-ats-modern .resume-header {
            padding: 2rem;
            position: relative;
        }
        
        .template-ats-modern .resume-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 50%;
            height: 2px;
            background-color: var(--primary-color, #5D5CDE);
        }
        
        .template-ats-modern .section-header h2 {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary-color, #5D5CDE);
            position: relative;
            margin-bottom: 1rem;
            padding-right: 16px;
        }
        
        .template-ats-modern .section-header h2::before {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 8px;
            background-color: var(--primary-color, #5D5CDE);
            border-radius: 50%;
        }
        
        .template-ats-modern .custom-list li:before {
            content: "•";
        }
        
        .template-ats-modern #personName {
            font-size: 2.25rem;
            font-weight: 700;
        }

        /* ATS Technical - مثالي للمهندسين والمهن التقنية */
        /* ATS Creative */
.template-ats-creative .resume-header {
    padding: 2rem 1.5rem;
    position: relative;
}

.template-ats-creative .resume-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 8px;
    background: linear-gradient(to right, var(--primary-color, #5D5CDE), transparent);
}

.template-ats-creative .section-header h2 {
    font-weight: 700;
    font-size: 1.2rem;
    margin-bottom: 1rem;
    color: var(--primary-color, #5D5CDE);
    position: relative;
    display: inline-block;
}

.template-ats-creative .section-header h2::after {
    content: '';
    position: absolute;
    width: 100%;
    height: 2px;
    bottom: -5px;
    right: 0;
    background: linear-gradient(to right, var(--primary-color, #5D5CDE), transparent);
}

.template-ats-creative .custom-list li:before {
    content: "◆";
    font-size: 0.7rem;
}

/* تعديل الاسم العلوي لضمان عدم عكسه عند الحفظ */
.template-ats-creative #personName {
    font-size: 2.25rem;
    font-weight: 700;
    transform: none;
    direction: ltr;
    unicode-bidi: embed;
}

/* ATS Chronological - يركز على التسلسل الزمني للخبرات */
.template-ats-chronological .resume-header {
    padding: 1.5rem;
    text-align: center;
    border-bottom: 1px solid var(--primary-color, #5D5CDE);
}

.template-ats-chronological .section-header h2 {
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 1rem;
    color: var(--primary-color, #5D5CDE);
    border-bottom: 1px solid var(--primary-color, #5D5CDE);
    padding-bottom: 5px;
}

.template-ats-chronological .custom-list li:before {
    content: "•";
}

/* تعديل الاسم العلوي لضمان عدم عكسه عند الحفظ */
.template-ats-chronological #personName {
    font-size: 2rem;
    font-weight: 700;
    transform: none;
    direction: ltr;
    unicode-bidi: embed;
}

/* ATS Functional - يركز على المهارات والكفاءات */
.template-ats-functional .resume-header {
    padding: 1.5rem;
    border-bottom: 2px solid var(--primary-color, #5D5CDE);
}

.template-ats-functional .section-header h2 {
    font-weight: 700;
    font-size: 1.2rem;
    margin-bottom: 1rem;
    color: #fff;
    background-color: var(--primary-color, #5D5CDE);
    padding: 5px 10px;
    border-radius: 4px;
    display: inline-block;
}

.template-ats-functional .custom-list li:before {
    content: "✓";
}

/* تعديل الاسم العلوي لضمان عدم عكسه عند الحفظ */
.template-ats-functional #personName {
    font-size: 2rem;
    font-weight: 700;
    transform: none;
    direction: ltr;
    unicode-bidi: embed;
}


        /* ATS Creative - أكثر إبداعًا مع الحفاظ على توافقية ATS */
        .template-ats-creative .resume-header {
            padding: 2rem 1.5rem;
            position: relative;
        }
        
        .template-ats-creative .resume-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: linear-gradient(to right, var(--primary-color, #5D5CDE), transparent);
        }
        
        .template-ats-creative .section-header h2 {
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--primary-color, #5D5CDE);
            position: relative;
            display: inline-block;
        }
        
        .template-ats-creative .section-header h2::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 2px;
            bottom: -5px;
            right: 0;
            background: linear-gradient(to right, var(--primary-color, #5D5CDE), transparent);
        }
        
        .template-ats-creative .custom-list li:before {
            content: "◆";
            font-size: 0.7rem;
        }
        
        .template-ats-creative #personName {
            font-size: 2.25rem;
            font-weight: 700;
        }

        /* ATS Chronological - يركز على التسلسل الزمني للخبرات */
        .template-ats-chronological .resume-header {
            padding: 1.5rem;
            text-align: center;
            border-bottom: 1px solid var(--primary-color, #5D5CDE);
        }
        
        .template-ats-chronological .section-header h2 {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--primary-color, #5D5CDE);
            border-bottom: 1px solid var(--primary-color, #5D5CDE);
            padding-bottom: 5px;
        }
        
        .template-ats-chronological .custom-list li:before {
            content: "•";
        }
        
        .template-ats-chronological #personName {
            font-size: 2rem;
            font-weight: 700;
        }

        /* ATS Functional - يركز على المهارات والكفاءات */
        /* ATS Functional - يركز على المهارات والكفاءات */
        .template-ats-functional .resume-header {
            padding: 1.5rem;
            border-bottom: 2px solid var(--primary-color, #5D5CDE);
        }

        .template-ats-functional .section-header h2 {
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: #fff;
            background-color: var(--primary-color, #5D5CDE);
            padding: 8px 12px; /* زيادة التباعد الداخلي */
            border-radius: 4px;
            display: inline-block;
            border-bottom: 4px solid var(--primary-color, #5D5CDE); /* زيادة السمك */
        }

        .template-ats-functional .custom-list li:before {
            content: "✓";
        }

        .template-ats-functional #personName {
            font-size: 2rem;
            font-weight: 700;
        }

/* إزالة الهوامش البيضاء عند الطباعة أو الحفظ */
        html, body {
             width: 100%;
             height: 100%;
             margin: 0;
             padding: 0;
        }

        @page {
             margin: 0;
        }

        /* ATS Professional - نموذج رسمي مهني */
        .template-ats-professional .resume-header {
            padding: 1.5rem;
            border-bottom: 1px solid #ccc;
        }
        
        .template-ats-professional .section-header h2 {
            font-size: 1.25rem;
            font-weight: 700;
            padding: 0.5rem;
            background-color: #F3F4F6;
            border-right: 4px solid var(--primary-color, #5D5CDE);
            margin-bottom: 1rem;
        }
        
        .template-ats-professional .custom-list li:before {
            content: ">";
        }
        
        .template-ats-professional #personName {
            font-size: 2rem;
            font-weight: 700;
        }

        /* ATS Elegant - نموذج راقي */
        .template-ats-elegant .resume-header {
            padding: 2rem 1.5rem;
            text-align: center;
            border-bottom: double 6px var(--primary-color, #5D5CDE);
        }
        
        .template-ats-elegant .section-header h2 {
            font-weight: 700;
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: var(--primary-color, #5D5CDE);
            text-align: center;
            position: relative;
        }
        
        .template-ats-elegant .section-header h2::before,
        .template-ats-elegant .section-header h2::after {
            content: "--";
            position: relative;
            top: -0.3rem;
            color: var(--primary-color, #5D5CDE);
            padding: 0 0.5rem;
        }
        
        .template-ats-elegant .custom-list li:before {
            content: "•";
        }
        
        .template-ats-elegant #personName {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

/* ATS Clean - مظهر متوازن وجذاب */
.template-ats-clean .resume-header {
    padding: 1.5rem;
    text-align: center;
}

.template-ats-clean .section-header h2 {
    font-size: 1.25rem;
    font-weight: 700;
    display: inline-block;
    border-bottom: 2px solid var(--primary-color, #5D5CDE);
    padding-bottom: 0.25rem;
    margin-bottom: 1rem;
    direction: ltr;
    unicode-bidi: embed;
    letter-spacing: 0.02em; /* تقليل التباعد */
    white-space: nowrap; /* منع التفاف النص */
}


/* ATS Clean - مظهر متوازن وجذاب */
.template-ats-clean .resume-header {
    padding: 1.5rem;
    text-align: center;
}

.template-ats-clean .section-header h2 {
    font-size: 1.25rem;
    font-weight: 700;
    display: inline-block;
    border-bottom: 2px solid var(--primary-color, #5D5CDE);
    padding-bottom: 0.25rem;
    margin-bottom: 1rem;
    direction: ltr; /* إصلاح مشكلة الانعكاس */
    unicode-bidi: embed;
}

.template-ats-clean .custom-list li:before {
    content: "•";
    color: var(--primary-color, #5D5CDE);
}

.template-ats-clean #personName {
    font-size: 2rem;
    font-weight: 700;
}


        /* ATS Standard - نموذج واضح ومباشر */
        .template-ats-standard .resume-header {
            padding: 1.5rem;
            text-align: center;
        }
        
        .template-ats-standard .section-header h2 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: #1F2937;
            border-bottom: 2px solid var(--primary-color, #5D5CDE);
            padding-bottom: 0.5rem;
        }
        
        .template-ats-standard .custom-list li:before {
            content: "•";
        }
        
        .template-ats-standard #personName {
            font-size: 2rem;
            font-weight: 700;
        }


       



      /* نموذج Modern Split - تصميم حديث مقسم */
.template-modern-split .resume-header {
    background-color: var(--primary-color, #5D5CDE); /* جعل الخلفية بالكامل بنفسجي */
    padding: 2.5rem 0;  /* الحفاظ على التباعد العلوي والسفلي */
    color: white;
    position: relative;
    overflow: hidden;
    width: 100% !important; /* التأكد من أن الهيدر يشمل كامل العرض */
    height: 200px; /* تحديد ارتفاع الهيدر ليصبح مستطيلًا */
    display: flex;
    justify-content: center;
    align-items: center;  /* تمركز النص داخل الهيدر */
    text-align: center;   /* تمركز النص أفقيًا */
    box-sizing: border-box; /* التأكد من أن العرض والارتفاع يشملان padding */
    margin: 0 !important; /* إزالة الهوامش */
    left: 0;
    right: 0;
}

/* تعديل للشخص اسمه ليظهر بشكل جيد */
.template-modern-split #personName {
    font-size: 2.5rem;
    font-weight: 800;
    position: relative;
    z-index: 2;
    max-width: 60%;
}

/* تحسين العنوان الرئيسي */
.template-modern-split .section-header h2 {
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 2rem; /* زيادة المسافة بين العنوان والخطوط الصغيرة */
    position: relative;
    padding-bottom: 1rem;  /* زيادة المسافة أسفل العنوان */
}

/* تحسين الخطوط الصغيرة بعد العناوين */
.template-modern-split .section-header h2::after {
    content: '';
    position: absolute;
    bottom: -12px; /* زيادة المسافة بين الخط والعنوان */
    right: 0;
    width: 50px; /* زيادة عرض الخط الصغير */
    height: 3px;
    background-color: var(--primary-color, #5D5CDE);
}

/* القائمة الفرعية */
.template-modern-split .custom-list li:before {
    content: "•";
    color: var(--primary-color, #5D5CDE);
}

/* تخصيص الأعمدة */
.template-modern-split #rightColumn {
    background-color: #f9fafb;
    border-radius: 10px;
    padding: 1.5rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    margin-top: 20px; /* خفض المربعات لأسفل قليلاً */
    position: relative;
    z-index: 5;
}

.template-modern-split #leftColumn {
    padding: 1.5rem;
}


        /* نموذج Creative Geometric - تصميم هندسي إبداعي */
        .template-creative-geometric .resume-header {
            background-color: var(--primary-color, #5D5CDE);
            padding: 2.5rem 2rem;
            position: relative;
            overflow: hidden;
            clip-path: polygon(0 0, 100% 0, 100% 80%, 0 100%);
            min-height: 200px;
        }
        
        .template-creative-geometric .resume-header::before {
            content: '';
            position: absolute;
            top: 20px;
            right: 20px;
            width: 100px;
            height: 100px;
            background-color: rgba(255,255,255,0.1);
            border-radius: 50%;
            z-index: 1;
        }
        
        .template-creative-geometric .resume-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 40px;
            width: 70px;
            height: 70px;
            background-color: rgba(255,255,255,0.1);
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
            z-index: 1;
        }
        
        .template-creative-geometric #personName {
            font-size: 2.4rem;
            font-weight: 800;
            color: white;
            position: relative;
            z-index: 2;
        }
        
        .template-creative-geometric #contentContainer {
            padding-top: 3rem;
            position: relative;
        }
        
        .template-creative-geometric .section-header {
            margin-bottom: 1.5rem;
            position: relative;
        }
        
        .template-creative-geometric .section-header h2 {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-color, #5D5CDE);
            position: relative;
            display: inline-block;
            padding-right: 20px;
        }
        
        .template-creative-geometric .section-header h2::before {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background-color: var(--primary-color, #5D5CDE);
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
        }
        
        .template-creative-geometric .custom-list li:before {
            content: "•";
            color: var(--primary-color, #5D5CDE);
        }
        
        .template-creative-geometric #rightColumn,
        .template-creative-geometric #leftColumn {
            position: relative;
        }

        /* نموذج Formal Timeline - تصميم زمني رسمي */
        /* نموذج Formal Timeline - تصميم رسمي مع تسلسل زمني */
.template-formal-timeline .resume-header {
    background-color: var(--primary-color, #5D5CDE);
    padding: 1.5rem;
    color: white;
    text-align: center;
    border-bottom: 10px solid #f9fafb;
}

.template-formal-timeline #personName {
    font-size: 2.2rem;
    font-weight: 700;
    letter-spacing: 0.05em;
    direction: ltr; /* التأكد من أن النص يظهر بشكل صحيح عند الحفظ */
}

.template-formal-timeline #contentContainer {
    background-color: white;
    position: relative;
}

.template-formal-timeline .section-header h2 {
    font-size: 1.3rem;
    font-weight: 700;
    color: white;
    background-color: var(--primary-color, #5D5CDE);
    display: inline-block;
    padding: 5px 15px;
    border-radius: 0 0 10px 0;
    margin-bottom: 1rem;
}

/* جعل النقاط أسفل العناوين الرئيسية دوائر مفرغة */
.template-formal-timeline #experience-section ul,
.template-formal-timeline #education-section ul,
.template-formal-timeline #courses-section ul {
    position: relative;
    border-right: 2px solid var(--primary-color, #5D5CDE);
    padding-right: 2rem;
}

.template-formal-timeline #experience-section ul li:nth-child(3n+1)::before,
.template-formal-timeline #education-section ul li:nth-child(3n+1)::before,
.template-formal-timeline #courses-section ul li:nth-child(4n+1)::before {
    content: " ";
    width: 10px;  /* تصغير حجم الدائرة */
    height: 10px; /* تصغير حجم الدائرة */
    background-color: transparent; /* دائرة فارغة */
    border: 2px solid var(--primary-color, #5D5CDE);
    border-radius: 50%;
    position: absolute;
    right: -8px;
    top: 5px;
}

/* جعل النقاط في القائمة تكون دوائر مفرغة */
.template-formal-timeline .custom-list li:before {
    content: " ";
    width: 10px;  /* تصغير حجم الدائرة */
    height: 10px; /* تصغير حجم الدائرة */
    background-color: transparent; /* دائرة فارغة */
    border: 2px solid var(--primary-color, #5D5CDE);
    border-radius: 50%;
}



        /* نموذج Minimalist Card - بطاقة بسيطة */
        .template-minimalist-card {
            font-family: var(--font-family);
            background-color: #f9fafb;
        }
        
        .template-minimalist-card .resume-header {
            background-color: white;
            border-bottom: none;
            padding: 2rem;
            text-align: center;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin: 1rem;
        }
        
        .template-minimalist-card #personName {
            font-size: 2.2rem;
            font-weight: 300;
            color: #111827;
            letter-spacing: 0.1em;
        }
        
        .template-minimalist-card #contentContainer {
            padding: 0;
        }
        
        .template-minimalist-card #rightColumn,
        .template-minimalist-card #leftColumn {
            padding: 1rem;
        }
        
        .template-minimalist-card .draggable-section {
            background-color: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .template-minimalist-card .section-header h2 {
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--primary-color, #5D5CDE);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .template-minimalist-card .custom-list li:before {
            content: "•";
            color: var(--primary-color, #5D5CDE);
        }
        
        .template-minimalist-card #customSectionsContainer .draggable-section {
            margin: 1rem;
        }
        
        /* نماذج إضافية جديدة */
        
        /* نموذج Corporate Elegance - تصميم شركات أنيق */
        .template-corporate-elegance .resume-header {
            background-color: #f9fafb;
            padding: 2rem;
            text-align: center;
            border-bottom: 3px solid var(--primary-color, #5D5CDE);
            position: relative;
        }
        
        .template-corporate-elegance .resume-header::before,
        .template-corporate-elegance .resume-header::after {
            content: '';
            position: absolute;
            bottom: -3px;
            width: 20%;
            height: 3px;
            background-color: #9ca3af;
        }
        
        .template-corporate-elegance .resume-header::before {
            right: 0;
        }
        
        .template-corporate-elegance .resume-header::after {
            left: 0;
        }
        
        .template-corporate-elegance #personName {
            font-size: 2.4rem;
            font-weight: 700;
            color: #1f2937;
        }
        
        .template-corporate-elegance .section-header h2 {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-color, #5D5CDE);
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 1rem;
        }
        
        .template-corporate-elegance .custom-list li:before {
            content: "•";
            color: var(--primary-color, #5D5CDE);
        }
        
        .template-corporate-elegance .draggable-section {
            margin-bottom: 1.5rem;
        }

        /* نموذج Academic Classic - النموذج الأكاديمي الكلاسيكي */
        .template-academic-classic .resume-header {
            padding: 2rem;
            text-align: center;
            border-bottom: 1px solid #d1d5db;
        }
        
        .template-academic-classic #personName {
            font-size: 2.3rem;
            font-weight: 700;
            font-family: 'Amiri', serif;
            margin-bottom: 0.5rem;
        }
        
        .template-academic-classic .section-header h2 {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-color, #5D5CDE);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 1rem;
            font-family: 'Amiri', serif;
            text-align: center;
        }
        
        .template-academic-classic .section-header h2::after {
            content: '';
            display: block;
            width: 80px;
            height: 2px;
            background-color: var(--primary-color, #5D5CDE);
            margin: 0.5rem auto 0;
        }
        
        .template-academic-classic .custom-list li:before {
            content: "•";
            color: var(--primary-color, #5D5CDE);
        }
        
        .template-academic-classic .draggable-section {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px dotted #d1d5db;
        }

        /* نموذج Modern Blocks - تصميم بلوكات عصرية */
        .template-modern-blocks {
            --section-gap: 1.5rem;
        }
        
        .template-modern-blocks .resume-header {
            background-color: var(--primary-color, #5D5CDE);
            color: white;
            padding: 2.5rem 2rem;
            text-align: center;
            position: relative;
        }
        
        .template-modern-blocks #personName {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }
        
        .template-modern-blocks #contentContainer {
            padding: 2rem 0;
            background-color: #f9fafb;
        }
        
        .template-modern-blocks .draggable-section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            padding: 1.5rem;
            margin-bottom: var(--section-gap);
        }
        
        .template-modern-blocks .section-header h2 {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color, #5D5CDE);
            margin-bottom: 1rem;
            position: relative;
            padding-right: 1rem;
        }
        
        .template-modern-blocks .section-header h2::before {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 5px;
            height: 20px;
            background-color: var(--primary-color, #5D5CDE);
            border-radius: 2px;
        }
        
        .template-modern-blocks .custom-list li:before {
            content: "•";
            color: var(--primary-color, #5D5CDE);
        }
        
        .template-modern-blocks #rightColumn,
        .template-modern-blocks #leftColumn {
            padding: 0 1rem;
        }

        /* نموذج Digital Marketing - تصميم التسويق الرقمي */
        .template-digital-marketing .resume-header {
    background-color: #111827;
    color: white;
    padding: 2.5rem 2rem;
    position: relative;
    overflow: hidden;
}

.template-digital-marketing .resume-header::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 40%;
    height: 100%;
    background: repeating-linear-gradient(
        45deg,
        var(--primary-color, #5D5CDE),
        var(--primary-color, #5D5CDE) 10px,
        rgba(var(--primary-rgb, 93, 92, 222), 0.8) 10px,
        rgba(var(--primary-rgb, 93, 92, 222), 0.8) 20px
    );
    opacity: 0.2;
    z-index: 1;
}

.template-digital-marketing #personName {
    font-size: 2.8rem;
    font-weight: 800;
    position: relative;
    z-index: 2;
    margin-bottom: 0.5rem;
}

.template-digital-marketing .section-header h2 {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--primary-color, #5D5CDE);
    margin-bottom: 1rem;
    position: relative;
    display: inline-block;
    padding-bottom: 5px;
}

.template-digital-marketing .section-header h2::after {
    content: none; /* إزالة الخط أسفل العنوان */
}

.template-digital-marketing .custom-list li:before {
    content: "•";
    color: var(--primary-color, #5D5CDE);
}

.template-digital-marketing .draggable-section {
    margin-bottom: 1.5rem;
}


        /* نموذج AI Professional - تصميم لمتخصصي الذكاء الاصطناعي */
        .template-ai-professional .resume-header {
    background-color: #1e1e1e;
    padding: 2.5rem 2rem;
    color: white;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.template-ai-professional .resume-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        radial-gradient(circle at 10% 20%, rgba(var(--primary-rgb, 93, 92, 222), 0.3) 0%, transparent 30%),
        radial-gradient(circle at 90% 80%, rgba(var(--primary-rgb, 93, 92, 222), 0.3) 0%, transparent 30%);
    z-index: 1;
}

.template-ai-professional #personName {
    font-size: 2.4rem;
    font-weight: 700;
    position: relative;
    z-index: 2;
    letter-spacing: 0.05em;
    background: linear-gradient(to right, #fff, var(--primary-color, #5D5CDE));
    color: transparent;
    display: inline-block;
    -webkit-background-clip: text; /* للتأكد من دعم المتصفحات الحديثة */
    background-clip: text;
}

/* في حالة فشل background-clip في بعض المتصفحات */
.template-ai-professional #personName {
    color: var(--primary-color, #5D5CDE); /* استخدم اللون الأساسي هنا مباشرة */
}

.template-ai-professional .section-header h2 {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--primary-color, #5D5CDE);
    margin-bottom: 1rem;
    padding-right: 15px;
    position: relative;
}

.template-ai-professional .section-header h2::before {
    content: '{ ';
    position: absolute;
    right: 0;
    color: var(--primary-color, #5D5CDE);
}

.template-ai-professional .section-header h2::after {
    content: ' }';
    color: var(--primary-color, #5D5CDE);
}

.template-ai-professional .custom-list li:before {
    content: ">";
    color: var(--primary-color, #5D5CDE);
    font-family: monospace;
}

.template-ai-professional .draggable-section {
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #e5e7eb;
}

        /* نموذج Legal Expert - تصميم للمحامين والمستشارين القانونيين */
        .template-legal-expert .resume-header {
            background-color: #f8fafc;
            padding: 2rem;
            border-bottom: 2px solid var(--primary-color, #5D5CDE);
            text-align: center;
            position: relative;
        }
        
        .template-legal-expert .resume-header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 2px;
            background-color: #64748b;
        }
        
        .template-legal-expert #personName {
            font-size: 2.5rem;
            font-weight: 700;
            font-family: 'Amiri', serif;
            color: #0f172a;
            margin-bottom: 0.5rem;
        }
        
        .template-legal-expert .section-header h2 {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-color, #5D5CDE);
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
            font-family: 'Amiri', serif;
        }
        
        .template-legal-expert .custom-list li:before {
            content: "•";
            color: var(--primary-color, #5D5CDE);
        }
        
        .template-legal-expert .custom-list li {
            margin-bottom: 0.75rem;
        }
        
        .template-legal-expert .draggable-section {
            margin-bottom: 1.5rem;
        }

        /* نموذج Medical Professional - تصميم للمهنيين الطبيين */
        .template-medical-professional .resume-header {
            background-color: var(--primary-color, #5D5CDE);
            padding: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            color: white;
        }
        
        .template-medical-professional .resume-header::before {
            content: '+';
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 6rem;
            color: rgba(255,255,255,0.1);
            font-weight: 300;
        }
        
        .template-medical-professional .resume-header::after {
            content: '+';
            position: absolute;
            bottom: 10px;
            left: 20px;
            font-size: 4rem;
            color: rgba(255,255,255,0.1);
            font-weight: 300;
        }
        
        .template-medical-professional #personName {
            font-size: 2.4rem;
            font-weight: 700;
            position: relative;
            z-index: 2;
        }
        
        .template-medical-professional .section-header h2 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-color, #5D5CDE);
            margin-bottom: 1rem;
            padding: 5px 15px;
            background-color: #f1f5f9;
            border-radius: 20px;
            display: inline-block;
        }
        
        .template-medical-professional .custom-list li:before {
            content: "•";
            color: var(--primary-color, #5D5CDE);
        }
        
        .template-medical-professional .draggable-section {
            margin-bottom: 1.5rem;
            background-color: white;
            border-radius: 8px;
            padding: 1.25rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .template-medical-professional #contentContainer {
            background-color: #f8fafc;
            padding: 2rem 1rem;
        }

        /* تنسيقات لوحة منتقي الخطوط */
        .font-option {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            border: 2px solid transparent;
        }
        
        .font-option:hover {
            background-color: #f3f4f6;
        }
        
        .font-option.active {
            border-color: var(--primary-color, #5D5CDE);
            background-color: rgba(var(--primary-rgb, 93, 92, 222), 0.05);
        }
        
        .font-preview {
            font-size: 1.5rem;
            margin-left: 10px;
            flex-grow: 1;
        }
        
        .font-name {
            font-size: 14px;
            color: #6b7280;
        }
        
        .font-size-control {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e5e7eb;
        }
        
        .font-size-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .font-size-btn {
            padding: 6px 12px;
            border-radius: 4px;
            background-color: #f3f4f6;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-weight: 500;
        }
        
        .font-size-btn:hover {
            background-color: #e5e7eb;
        }
        
        .font-size-btn.active {
            background-color: var(--primary-color, #5D5CDE);
            color: white;
        }
        
        /* تحسينات الأزرار */
        .action-button {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.25rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .action-button:active {
            transform: translateY(0);
        }
        
        .action-button i {
            margin-left: 8px;
        }
        
        .action-button::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background-color: rgba(255,255,255,0.1);
            transform: translateX(-100%);
            transition: transform 0.3s;
        }
        
        .action-button:hover::after {
            transform: translateX(0);
        }
        
        .button-edit {
            background-color: var(--primary-color, #5D5CDE);
            color: white;
        }
        
        .button-save {
            background-color: #10b981;
            color: white;
        }
        
        .button-customize {
            background-color: #8b5cf6;
            color: white;
        }
        
        .button-color {
            background-color: #6b7280;
            color: white;
        }
        
        .button-font {
            background-color: #ef4444;
            color: white;
        }
        
        .button-bullet {
            background-color: #f97316;
            color: white;
        }
        
        /* لوحة تحتوي على الزر المفعل والتلميح */
        .tooltip {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #1f2937;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 100;
        }
        
        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #1f2937 transparent transparent transparent;
        }
        
        .action-button-container {
            position: relative;
        }
        
        .action-button-container:hover .tooltip {
            opacity: 1;
        }

        /* لوحة معاينة قوالب التصميم المختلفة */
        .custom-templates-panel {
            position: fixed;
            width: 350px;
            height: 100vh;
            left: 0;
            top: 0;
            transform: none;
            background-color: white;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
            display: none;
        }
        
        /* تعديلات لتحديد متعدد للنقاط */
        .custom-list li.selected {
            background-color: rgba(var(--primary-rgb, 93, 92, 222), 0.1);
            border-radius: 4px;
        }
        
        .copy-selected-btn {
            display: none;
            margin-top: 10px;
            background-color: var(--primary-color, #5D5CDE);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .copy-selected-btn:hover {
            opacity: 0.9;
        }
        
        /* نافذة التحديد المتعدد */
        .multi-select-tooltip {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 14px;
            z-index: 1000;
            display: none;
        }
        
        .paste-multiline-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--primary-color, #5D5CDE);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 100;
            display: none;
        }
        
        .paste-multiline-btn:hover {
            transform: scale(1.05);
        }
        
        .edit-mode .paste-multiline-btn {
            display: flex;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }
        
        /* تعديلات لميزة تحديد أكثر من نقطة */
        .multi-selection-controls {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            background-color: rgba(0,0,0,0.8);
            color: white;
            border-radius: 5px;
            padding: 10px;
        }
        
        .edit-mode .multi-selection-controls.active {
            display: block;
        }
        
        .selection-actions {
            display: flex;
            gap: 10px;
            margin-top: 8px;
        }
        
        .selection-action-btn {
            background-color: var(--primary-color, #5D5CDE);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .selection-action-btn:hover {
            opacity: 0.9;
        }
        
        .selection-action-btn.delete {
            background-color: #e53e3e;
        }
        
        /* تحسين عرض قائمة التصاميم */
        .designs-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            padding: 10px;
            margin-top: 15px;
        }
        
        .design-item {
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .design-item:hover {
            border-color: var(--primary-color, #5D5CDE);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .design-item.active {
            border-color: var(--primary-color, #5D5CDE);
            background-color: rgba(var(--primary-rgb, 93, 92, 222), 0.05);
        }
        
        .design-item-title {
            font-weight: 700;
            margin-bottom: 5px;
            font-size: 1.1rem;
            color: var(--primary-color, #5D5CDE);
        }
        
        .design-item-desc {
            font-size: 0.9rem;
            color: #6B7280;
        }
        
        .design-categories {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }
        
        .design-category {
            padding: 5px 12px;
            background-color: #F3F4F6;
            border-radius: 15px;
            font-size: 0.9rem;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }
        
        .design-category.active {
            background-color: var(--primary-color, #5D5CDE);
            color: white;
        }
        
        /* إصلاح مشكلة ظهور الأحرف العربية معكوسة */
        [dir="rtl"] {
            unicode-bidi: embed;
        }
        
        /* تأكيد على النقاط في كل التصميمات */
        .custom-list li::before {
            content: var(--bullet-type, '•') !important;
            display: inline-block !important;
            color: var(--primary-color, #5D5CDE) !important;
        }
        
        /* تنسيق خاص للعناوين الرئيسية في جميع التصميمات */
        .section-header h2 {
            position: relative;
            display: inline-block;
            margin-bottom: 1rem !important;
        }
        
        /* زر إغلاق قائمة التصاميم */
        .close-templates-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            background-color: #f3f4f6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .close-templates-btn:hover {
            background-color: #e5e7eb;
        }
        
        /* تعديل عرض المحتوى الرئيسي عند ظهور القائمة */
        .content-shifted {
            margin-left: 350px;
            transition: margin-left 0.3s ease;
        }
        
        /* إعداد تجاوب لشاشات الموبايل */
        @media (max-width: 768px) {
            .custom-templates-panel {
                width: 280px;
            }
            
            .content-shifted {
                margin-left: 0;
            }
        }
        
        /* تنسيقات إضافية لنافذة إدخال النص الكامل */
        #bulkTextModal {
            animation: fadeIn 0.3s ease-out;
        }
        
        #bulkTextInput {
            font-size: 16px;
            min-height: 300px;
        }

        /* تنسيقات نافذة تأكيد الحذف */
        .delete-confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
        }

        .delete-confirm-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .delete-confirm-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 320px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-align: center;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }

        .delete-confirm-modal.active .delete-confirm-content {
            transform: translateY(0);
        }

        .delete-confirm-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .delete-confirm-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .delete-confirm-btn.confirm {
            background-color: #e53e3e;
            color: white;
        }

        .delete-confirm-btn.confirm:hover {
            background-color: #c53030;
        }

        .delete-confirm-btn.cancel {
            background-color: #e2e8f0;
            color: #4a5568;
        }

        .delete-confirm-btn.cancel:hover {
            background-color: #cbd5e0;
        }

        /* Fix for new sections appearing faded */
        .custom-section {
            opacity: 1 !important;
            border-color: var(--border-color, #E5E7EB);
            background-color: var(--background-color, #FFFFFF);
            color: var(--text-color, #1F2937);
        }
        
        /* Reduce margins for PDF export */
        #resumeContent {
            max-width: 100%;
            margin: 0 auto;
            overflow: hidden; /* Para evitar desbordamiento */
        }
        
        /* Ajustar los encabezados de sección del lado derecho */
        #rightColumn .section-header h2 {
            padding-right: 15px; /* Más espacio a la derecha */
            text-align: right;
        }
        
        /* Asegurar que el encabezado se extienda por todo el ancho */
        .resume-header {
            width: 100% !important;
            margin: 0 !important;
            padding-left: 0 !important;
            padding-right: 0 !important;
            box-sizing: border-box;
            left: 0;
            right: 0;
        }
        
        /* Fix for PDF generation - reduce margins */
        @media print {
            @page {
                margin: 0;
                padding: 0;
            }
            
            body, html {
                margin: 0 !important;
                padding: 0 !important;
                width: 100% !important;
            }
            
            .resume-header {
                width: 100% !important;
                max-width: 100% !important;
                margin: 0 !important;
            }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 p-4">
    <!-- قائمة التصاميم -->
    <div id="customTemplatesPanel" class="custom-templates-panel">
        <div class="mb-4">
            <button id="closeTemplatesBtn" class="close-templates-btn">
                <i class="fas fa-times"></i>
            </button>
            <h3 class="text-xl font-bold mb-2">اختر تصميم السيرة الذاتية</h3>
            <p class="text-gray-600 mb-4">مجموعة متنوعة من التصاميم المتوافقة مع نظام ATS</p>
            
            <!-- فئات التصاميم -->
            <div class="design-categories">
                <div class="design-category active" data-category="all">الكل</div>
                <div class="design-category" data-category="professional">مهني</div>
                <div class="design-category" data-category="creative">إبداعي</div>
                <div class="design-category" data-category="minimal">بسيط</div>
                <div class="design-category" data-category="specialized">تخصصي</div>
                <div class="design-category" data-category="modern">عصري</div>
                <div class="design-category" data-category="ats">متوافق مع ATS</div>
            </div>
            
            <!-- معرض التصاميم المحسن -->
            <div class="designs-container">
                <!-- ATS تصاميم -->
                <div class="design-item" data-template="ats-executive" data-category="professional,ats">
                    <div class="design-item-title">Executive</div>
                    <div class="design-item-desc">للمناصب التنفيذية والإدارية العليا</div>
                </div>
                
                <div class="design-item" data-template="ats-minimalist" data-category="minimal,ats">
                    <div class="design-item-title">Minimalist</div>
                    <div class="design-item-desc">بسيط وأنيق مع تركيز على المحتوى</div>
                </div>
                
                <div class="design-item" data-template="ats-modern" data-category="modern,ats">
                    <div class="design-item-title">ATS Modern</div>
                    <div class="design-item-desc">للشركات الحديثة والمؤسسات التكنولوجية</div>
                </div>
                
                <div class="design-item" data-template="ats-technical" data-category="specialized,ats">
                    <div class="design-item-title">Technical</div>
                    <div class="design-item-desc">مثالي للمهندسين والمهن التقنية</div>
                </div>
                
                <div class="design-item" data-template="ats-creative" data-category="creative,ats">
                    <div class="design-item-title">Creative ATS</div>
                    <div class="design-item-desc">أكثر إبداعًا مع الحفاظ على توافقية ATS</div>
                </div>
                
                <div class="design-item" data-template="ats-chronological" data-category="professional,ats">
                    <div class="design-item-title">Chronological</div>
                    <div class="design-item-desc">يركز على التسلسل الزمني للخبرات</div>
                </div>
                
                <div class="design-item" data-template="ats-functional" data-category="professional,ats">
                    <div class="design-item-title">Functional</div>
                    <div class="design-item-desc">يركز على المهارات والكفاءات</div>
                </div>
                
                <div class="design-item" data-template="ats-professional" data-category="professional,ats">
                    <div class="design-item-title">Professional</div>
                    <div class="design-item-desc">تصميم رسمي مهني</div>
                </div>
                
                <div class="design-item" data-template="ats-elegant" data-category="creative,ats">
                    <div class="design-item-title">Elegant</div>
                    <div class="design-item-desc">نموذج راقي يناسب مختلف المجالات</div>
                </div>
                
                <div class="design-item" data-template="ats-banking" data-category="specialized,ats">
                    <div class="design-item-title">Banking</div>
                    <div class="design-item-desc">للقطاع المصرفي والمالي</div>
                </div>
                
                <div class="design-item" data-template="ats-clean" data-category="minimal,ats">
                    <div class="design-item-title">Clean</div>
                    <div class="design-item-desc">مظهر متوازن وجذاب</div>
                </div>
                
                <div class="design-item" data-template="ats-standard" data-category="minimal,ats">
                    <div class="design-item-title">Standard</div>
                    <div class="design-item-desc">نموذج واضح ومباشر</div>
                </div>
                
                <!-- تصاميم متقدمة -->
                <div class="design-item" data-template="modern-split" data-category="modern,creative">
                    <div class="design-item-title">Modern Split</div>
                    <div class="design-item-desc">تصميم حديث بتقسيم مبتكر وألوان عصرية</div>
                </div>
                
                <div class="design-item" data-template="elegant-borders" data-category="professional,creative">
                    <div class="design-item-title">Elegant Borders</div>
                    <div class="design-item-desc">تصميم كلاسيكي أنيق بإطارات مزدوجة</div>
                </div>
                
                <div class="design-item" data-template="creative-geometric" data-category="creative,modern">
                    <div class="design-item-title">Creative Geometric</div>
                    <div class="design-item-desc">تصميم عصري بلمسات هندسية مميزة</div>
                </div>
                
                <div class="design-item" data-template="formal-timeline" data-category="professional">
                    <div class="design-item-title">Formal Timeline</div>
                    <div class="design-item-desc">تصميم رسمي يبرز الترتيب الزمني للخبرات</div>
                </div>
                
                <div class="design-item" data-template="minimalist-card" data-category="minimal">
                    <div class="design-item-title">Minimalist Card</div>
                    <div class="design-item-desc">تصميم بسيط أنيق بنمط البطاقات</div>
                </div>
                
                <div class="design-item" data-template="corporate-elegance" data-category="professional">
                    <div class="design-item-title">Corporate Elegance</div>
                    <div class="design-item-desc">تصميم أنيق للمهنيين والشركات</div>
                </div>
                
                <div class="design-item" data-template="academic-classic" data-category="specialized,professional">
                    <div class="design-item-title">Academic Classic</div>
                    <div class="design-item-desc">تصميم كلاسيكي مثالي للأكاديميين والباحثين</div>
                </div>
                
                <div class="design-item" data-template="modern-blocks" data-category="modern,minimal">
                    <div class="design-item-title">Modern Blocks</div>
                    <div class="design-item-desc">تصميم عصري بنمط البلوكات المنفصلة</div>
                </div>
                
                <div class="design-item" data-template="digital-marketing" data-category="specialized,modern">
                    <div class="design-item-title">Digital Marketing</div>
                    <div class="design-item-desc">تصميم عصري لمتخصصي التسويق الرقمي</div>
                </div>
                
                <div class="design-item" data-template="ai-professional" data-category="specialized,modern">
                    <div class="design-item-title">AI Professional</div>
                    <div class="design-item-desc">تصميم متخصص لمتخصصي الذكاء الاصطناعي والتقنية</div>
                </div>
                
                <div class="design-item" data-template="legal-expert" data-category="specialized,professional">
                    <div class="design-item-title">Legal Expert</div>
                    <div class="design-item-desc">تصميم مميز للمحامين والمستشارين القانونيين</div>
                </div>
                
                <div class="design-item" data-template="medical-professional" data-category="specialized">
                    <div class="design-item-title">Medical Professional</div>
                    <div class="design-item-desc">تصميم خاص بالمهنيين في المجال الطبي</div>
                </div>
            </div>
        </div>
        
        <!-- أزرار التحكم -->
        <div class="flex justify-center mt-4 border-t pt-4">
            <button id="applyCustomTemplate" class="bg-primary-custom hover:bg-blue-700 text-white font-bold py-2 px-4 rounded w-full">
                <i class="fas fa-check ml-1"></i> تطبيق التصميم المحدد
            </button>
        </div>
    </div>

    <!-- لوحة اختيار شكل النقاط -->
    <div id="bulletPickerPanel" class="bullet-picker-panel hidden">
        <div class="mb-3">
            <h3 class="text-lg font-bold mb-2">اختيار شكل النقاط</h3>
            <p class="text-sm text-gray-600 mb-3">اختر الشكل المناسب للنقاط في سيرتك الذاتية</p>
        </div>
        
        <div class="bullet-options-container">
            <div class="bullet-option active" data-bullet-type="normal">•</div>
            <div class="bullet-option" data-bullet-type="diamond">◆</div>
            <div class="bullet-option" data-bullet-type="triangle">►</div>
            <div class="bullet-option" data-bullet-type="check">✓</div>
            <div class="bullet-option" data-bullet-type="star">✦</div>
            <div class="bullet-option" data-bullet-type="square">■</div>
            <div class="bullet-option" data-bullet-type="circle">◉</div>
            <div class="bullet-option" data-bullet-type="arrow">➤</div>
            <div class="bullet-option" data-bullet-type="dash">--</div>
            <div class="bullet-option" data-bullet-type="plus">+</div>
            <div class="bullet-option" data-bullet-type="heart">♥</div>
            <div class="bullet-option" data-bullet-type="rarrow">❯</div>
        </div>

        <div class="mt-4 border-t pt-4">
            <p class="text-sm text-gray-600 mb-2">يمكنك تغيير شكل النقاط في أي وقت من خلال هذه القائمة</p>
        </div>
    </div>

    <div id="mainContent" class="max-w-4xl mx-auto">
        <!-- شريط الأدوات -->
        <div class="bg-white shadow rounded-lg p-4 mb-4 flex flex-wrap gap-3 justify-center sm:justify-between items-center no-print">
            <div class="flex flex-wrap items-center gap-2 w-full sm:w-auto">
                <div class="action-button-container">
                    <span class="tooltip">تحرير المحتوى أو حفظ التغييرات</span>
                    <button id="toggleEditBtn" class="action-button button-edit">
                        <i class="fas fa-edit"></i> تحرير المحتوى
                    </button>
                </div>
                
                <div class="action-button-container">
                    <span class="tooltip">حفظ السيرة بصيغة PDF</span>
                    <button id="generatePdfBtn" class="action-button button-save">
                        <i class="fas fa-file-pdf"></i> حفظ PDF
                    </button>
                </div>
                
                <div class="action-button-container">
                    <span class="tooltip">إدخال نص كامل للسيرة الذاتية</span>
                    <button id="bulkTextBtn" class="action-button" style="background-color: #38B2AC; color: white;">
                        <i class="fas fa-file-import ml-1"></i> إدخال النص بالكامل
                    </button>
                </div>
                
                <div class="action-button-container">
                    <span class="tooltip">اختيار تصميم السيرة</span>
                    <button id="customizeLayoutBtn" class="action-button button-customize">
                        <i class="fas fa-brush"></i> اختر التصميم
                    </button>
                </div>
                
                <div class="action-button-container relative">
                    <span class="tooltip">تغيير الألوان</span>
                    <button id="colorSettingsBtn" class="action-button button-color">
                        <i class="fas fa-palette"></i> الألوان
                    </button>
                    
                    <div id="colorPickerPanel" class="color-picker-panel hidden">
                        <div class="mb-3">
                            <h3 class="text-lg font-bold mb-2">تخصيص الألوان</h3>
                            <p class="text-sm text-gray-600 mb-3">اختر ألوان التصميم المناسبة</p>
                        </div>
                        
                        <div class="color-picker-container">
                            <span class="text-gray-700 text-sm font-semibold ml-2">اللون الرئيسي:</span>
                            <div id="primaryColorOptions" class="flex">
                                <div class="color-option active" style="background-color: #5D5CDE;" data-color="#5D5CDE" data-rgb="93,92,222"></div>
                                <div class="color-option" style="background-color: #2196F3;" data-color="#2196F3" data-rgb="33,150,243"></div>
                                <div class="color-option" style="background-color: #E91E63;" data-color="#E91E63" data-rgb="233,30,99"></div>
                                <div class="color-option" style="background-color: #4CAF50;" data-color="#4CAF50" data-rgb="76,175,80"></div>
                                <div class="color-option" style="background-color: #FF9800;" data-color="#FF9800" data-rgb="255,152,0"></div>
                                <div class="color-option" style="background-color: #009688;" data-color="#009688" data-rgb="0,150,136"></div>
                                <div class="color-option" style="background-color: #673AB7;" data-color="#673AB7" data-rgb="103,58,183"></div>
                                <div class="color-option" style="background-color: #03A9F4;" data-color="#03A9F4" data-rgb="3,169,244"></div>
                                <input type="color" id="customPrimaryColorPicker" value="#5D5CDE" class="cursor-pointer w-8 h-8 border-none outline-none rounded-full overflow-hidden p-0 bg-transparent">
                            </div>
                        </div>
                        
                        <div class="color-picker-container">
                            <span class="text-gray-700 text-sm font-semibold ml-2">لون الخلفية:</span>
                            <div id="backgroundColorOptions" class="flex">
                                <div class="color-option active" style="background-color: #FFFFFF;" data-color="#FFFFFF" data-rgb="255,255,255"></div>
                                <div class="color-option" style="background-color: #F0F9FF;" data-color="#F0F9FF" data-rgb="240,249,255"></div>
                                <div class="color-option" style="background-color: #F5F3FF;" data-color="#F5F3FF" data-rgb="245,243,255"></div>
                                <div class="color-option" style="background-color: #ECFDF5;" data-color="#ECFDF5" data-rgb="236,253,245"></div>
                                <div class="color-option" style="background-color: #FFFBEB;" data-color="#FFFBEB" data-rgb="255,251,235"></div>
                                <input type="color" id="customBackgroundColorPicker" value="#FFFFFF" class="cursor-pointer w-8 h-8 border-none outline-none rounded-full overflow-hidden p-0 bg-transparent">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="action-button-container relative">
                    <span class="tooltip">تغيير الخط والحجم</span>
                    <button id="fontSettingsBtn" class="action-button button-font">
                        <i class="fas fa-font"></i> الخطوط
                    </button>
                    
                    <div id="fontPickerPanel" class="font-picker-panel hidden">
                        <div class="mb-3">
                            <h3 class="text-lg font-bold mb-2">تخصيص نوع الخط</h3>
                            <p class="text-sm text-gray-600 mb-3">اختر الخط المناسب لسيرتك الذاتية</p>
                        </div>
                        
                        <div class="font-options">
                            <div class="font-option active" data-font="'Tajawal', sans-serif">
                                <div class="font-preview" style="font-family: 'Tajawal', sans-serif;">أبجد هوز</div>
                                <div class="font-name">Tajawal</div>
                            </div>
                            
                            <div class="font-option" data-font="'Almarai', sans-serif">
                                <div class="font-preview" style="font-family: 'Almarai', sans-serif;">أبجد هوز</div>
                                <div class="font-name">Almarai</div>
                            </div>
                            
                            <div class="font-option" data-font="'Cairo', sans-serif">
                                <div class="font-preview" style="font-family: 'Cairo', sans-serif;">أبجد هوز</div>
                                <div class="font-name">Cairo</div>
                            </div>
                            
                            <div class="font-option" data-font="'Changa', sans-serif">
                                <div class="font-preview" style="font-family: 'Changa', sans-serif;">أبجد هوز</div>
                                <div class="font-name">Changa</div>
                            </div>
                            
                            <div class="font-option" data-font="'El Messiri', sans-serif">
                                <div class="font-preview" style="font-family: 'El Messiri', sans-serif;">أبجد هوز</div>
                                <div class="font-name">El Messiri</div>
                            </div>
                            
                            <div class="font-option" data-font="'Amiri', serif">
                                <div class="font-preview" style="font-family: 'Amiri', serif;">أبجد هوز</div>
                                <div class="font-name">Amiri</div>
                            </div>
                            
                            <div class="font-option" data-font="'Reem Kufi', sans-serif">
                                <div class="font-preview" style="font-family: 'Reem Kufi', sans-serif;">أبجد هوز</div>
                                <div class="font-name">Reem Kufi</div>
                            </div>
                            
                            <div class="font-option" data-font="'Markazi Text', serif">
                                <div class="font-preview" style="font-family: 'Markazi Text', serif;">أبجد هوز</div>
                                <div class="font-name">Markazi Text</div>
                            </div>
                            
                            <div class="font-option" data-font="'Scheherazade New', serif">
                                <div class="font-preview" style="font-family: 'Scheherazade New', serif;">أبجد هوز</div>
                                <div class="font-name">Scheherazade New</div>
                            </div>
                            
                            <div class="font-option" data-font="'Lateef', cursive">
                                <div class="font-preview" style="font-family: 'Lateef', cursive;">أبجد هوز</div>
                                <div class="font-name">Lateef</div>
                            </div>
                            
                            <div class="font-option" data-font="'Mada', sans-serif">
                                <div class="font-preview" style="font-family: 'Mada', sans-serif;">أبجد هوز</div>
                                <div class="font-name">Mada</div>
                            </div>
                            
                            <div class="font-option" data-font="'Baloo Bhaijaan 2', cursive">
                                <div class="font-preview" style="font-family: 'Baloo Bhaijaan 2', cursive;">أبجد هوز</div>
                                <div class="font-name">Baloo Bhaijaan 2</div>
                            </div>
                            
                            <div class="font-option" data-font="'IBM Plex Sans Arabic', sans-serif">
                                <div class="font-preview" style="font-family: 'IBM Plex Sans Arabic', sans-serif;">أبجد هوز</div>
                                <div class="font-name">IBM Plex Sans Arabic</div>
                            </div>
                            
                            <div class="font-option" data-font="'Noto Kufi Arabic', sans-serif">
                                <div class="font-preview" style="font-family: 'Noto Kufi Arabic', sans-serif;">أبجد هوز</div>
                                <div class="font-name">Noto Kufi Arabic</div>
                            </div>
                            
                            <div class="font-option" data-font="'Aref Ruqaa', serif">
                                <div class="font-preview" style="font-family: 'Aref Ruqaa', serif;">أبجد هوز</div>
                                <div class="font-name">Aref Ruqaa</div>
                            </div>
                            
                            <div class="font-option" data-font="'Jomhuria', cursive">
                                <div class="font-preview" style="font-family: 'Jomhuria', cursive;">أبجد هوز</div>
                                <div class="font-name">Jomhuria</div>
                            </div>
                        </div>
                        
                        <div class="font-size-control">
                            <h4 class="text-md font-bold mb-2">حجم الخط</h4>
                            <div class="font-size-buttons grid grid-cols-3 gap-2">
                                <div class="font-size-btn" data-size-factor="0.9">صغير</div>
                                <div class="font-size-btn active" data-size-factor="1">متوسط</div>
                                <div class="font-size-btn" data-size-factor="1.1">كبير</div>
                                
                                <div class="font-size-btn" data-size-factor="0.8">أصغر</div>
                                <div class="font-size-btn" data-size-factor="1.05">كبير نسبياً</div>
                                <div class="font-size-btn" data-size-factor="1.2">أكبر</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="action-button-container relative">
                    <span class="tooltip">تغيير شكل النقاط</span>
                    <button id="bulletStyleBtn" class="action-button button-bullet">
                        <i class="fas fa-list"></i> شكل النقاط
                    </button>
                </div>
            </div>
            <div class="text-sm text-gray-600 font-semibold w-full sm:w-auto text-center sm:text-right">
                <div id="dragHint" class="hidden"> 
                    <i class="fas fa-arrows-alt-v ml-1 text-primary-custom"></i>
                    اسحب العناوين لإعادة ترتيبها
                </div>
                <div>انقر على أي قسم للتعديل بعد تفعيل وضع التحرير</div>
            </div>
        </div>
        
        <!-- نموذج السيرة الذاتية -->
        <div id="resumeContent" class="bg-custom shadow-lg rounded-lg overflow-hidden text-custom template-ats-standard" style="max-width: 100%; margin: 0 auto; padding: 0;">
            <!-- اسم الشخص في الترويسة -->
            <div class="resume-header bg-primary-custom p-8 text-center">
                <h1 id="personName" class="text-3xl md:text-4xl font-bold text-white" contenteditable="false">اسم الشخص</h1>
            </div>
            
            <div id="contentContainer" class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- القسم الأيمن: الهدف الوظيفي، التعليم، الدورات، المهارات -->
                    <div id="rightColumn" class="order-2 md:order-1">
                        <!-- الهدف الوظيفي -->
                        <div id="objective-section" class="mb-8 draggable-section" draggable="false" data-section-id="objective">
                            <div class="section-header flex items-center">
                                <i class="fas fa-grip-lines section-drag-handle" title="اسحب لتغيير الموضع"></i>
                                <h2 class="text-xl font-bold mb-4 text-primary-custom" contenteditable="false">الهدف الوظيفي</h2>
                                <i class="fas fa-trash-alt section-delete-btn"></i>
                            </div>
                            <ul class="custom-list objective-list">
                                <li contenteditable="false" class="mb-1">
                                    <span>السعي للعمل في بيئة احترافية تساعد على تطوير المهارات والخبرات.</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>المساهمة في تحقيق أهداف المؤسسة من خلال الاستفادة من الخبرات والمعارف المكتسبة.</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                            </ul>
                            <button class="add-item-btn objective-add-btn"><i class="fas fa-plus ml-1"></i> إضافة نقطة</button>
                        </div>
                        
                        <!-- التعليم -->
                        <div id="education-section" class="border-t border-custom pt-6 mb-8 draggable-section" draggable="false" data-section-id="education">
                            <div class="section-header flex items-center">
                                <i class="fas fa-grip-lines section-drag-handle" title="اسحب لتغيير الموضع"></i>
                                <h2 class="text-xl font-bold mb-4 text-primary-custom" contenteditable="false">التعليم</h2>
                                <i class="fas fa-trash-alt section-delete-btn"></i>
                            </div>
                            <ul class="custom-list education-list">
                                <li contenteditable="false" class="mb-1">
                                    <span>الشهادة / التخصص</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>اسم الجامعة أو المؤسسة التعليمية</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>2014 - 2018</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>الإنجازات الأكاديمية البارزة</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>المشاريع الرئيسية خلال فترة الدراسة</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                            </ul>
                            <button class="add-item-btn education-add-btn"><i class="fas fa-plus ml-1"></i> إضافة نقطة</button>
                        </div>
                        
                        <!-- الدورات -->
                        <div id="courses-section" class="border-t border-custom pt-6 mb-8 draggable-section" draggable="false" data-section-id="courses">
                            <div class="section-header flex items-center">
                                <i class="fas fa-grip-lines section-drag-handle" title="اسحب لتغيير الموضع"></i>
                                <h2 class="text-xl font-bold mb-4 text-primary-custom" contenteditable="false">الدورات</h2>
                                <i class="fas fa-trash-alt section-delete-btn"></i>
                            </div>
                            <ul class="custom-list courses-list">
                                <li contenteditable="false" class="mb-1">
                                    <span>اسم الدورة الأولى</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>الجهة المقدمة للدورة - 2019</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>محتوى الدورة والمهارات المكتسبة</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-3">
                                    <span>المشاريع المنجزة خلال الدورة</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                
                                <li contenteditable="false" class="mb-1">
                                    <span>اسم الدورة الثانية</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>الجهة المقدمة للدورة - 2020</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>محتوى الدورة والمهارات المكتسبة</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>المشاريع المنجزة خلال الدورة</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                            </ul>
                            <button class="add-item-btn courses-add-btn"><i class="fas fa-plus ml-1"></i> إضافة نقطة</button>
                        </div>
                        
                        <!-- المهارات -->
                        <div id="skills-section" class="border-t border-custom pt-6 draggable-section" draggable="false" data-section-id="skills">
                            <div class="section-header flex items-center">
                                <i class="fas fa-grip-lines section-drag-handle" title="اسحب لتغيير الموضع"></i>
                                <h2 class="text-xl font-bold mb-4 text-primary-custom" contenteditable="false">المهارات</h2>
                                <i class="fas fa-trash-alt section-delete-btn"></i>
                            </div>
                            <ul class="custom-list skills-list">
                                <li contenteditable="false" class="mb-1">
                                    <span>المهارة الأولى</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>المهارة الثانية</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>المهارة الثالثة</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>المهارة الرابعة</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                            </ul>
                            <button class="add-item-btn skills-add-btn"><i class="fas fa-plus ml-1"></i> إضافة نقطة</button>
                        </div>
                    </div>
                    
                    <!-- القسم الأيسر: المعلومات الشخصية، معلومات التواصل، الخبرات المهنية -->
                    <div id="leftColumn" class="order-1 md:order-2">
                        <!-- معلومات شخصية -->
                        <div id="contact-section" class="mb-8 draggable-section" draggable="false" data-section-id="contact">
                            <div class="section-header flex items-center">
                                <i class="fas fa-grip-lines section-drag-handle" title="اسحب لتغيير الموضع"></i>
                                <h2 class="text-xl font-bold mb-4 text-primary-custom" contenteditable="false">معلومات شخصية</h2>
                                <i class="fas fa-trash-alt section-delete-btn"></i>
                            </div>
                            <ul class="custom-list contact-list">
                                <li contenteditable="false" class="mb-2">
                                    <span>
                                        <i class="fas fa-phone text-primary-custom ml-2"></i>
                                        0512345678
                                    </span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-2">
                                    <span>
                                        <i class="fas fa-map-marker-alt text-primary-custom ml-2"></i>
                                        المدينة، الحي
                                    </span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-2">
                                    <span>
                                        <i class="fas fa-envelope text-primary-custom ml-2"></i>
                                        example@email.com
                                    </span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li> 
                                <li contenteditable="false" class="mb-2">
                                    <span>
                                        <i class="fas fa-id-card text-primary-custom ml-2"></i>
                                        الهوية
                                    </span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-2">
                                    <span>
                                        <i class="fas fa-calendar-alt text-primary-custom ml-2"></i>
                                        تاريخ الميلاد 
                                    </span>                                    
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                            </ul>
                            <button class="add-item-btn contact-add-btn"><i class="fas fa-plus ml-1"></i> إضافة معلومات</button>
                        </div>
                        
                        <!-- الخبرات المهنية -->
                        <div id="experience-section" class="border-t border-custom pt-6 mb-8 draggable-section" draggable="false" data-section-id="experience">
                            <div class="section-header flex items-center">
                                <i class="fas fa-grip-lines section-drag-handle" title="اسحب لتغيير الموضع"></i>
                                <h2 class="text-xl font-bold mb-4 text-primary-custom" contenteditable="false">الخبرات المهنية</h2>
                                <i class="fas fa-trash-alt section-delete-btn"></i>
                            </div>
                            <ul class="custom-list experience-list">
                                <li contenteditable="false" class="mb-1">
                                    <span>المسمى الوظيفي</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>اسم الشركة</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>2020 - الحالي</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>وصف المهام والمسؤوليات الرئيسية</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>المشاريع والإنجازات البارزة</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-3">
                                    <span>المهارات المكتسبة خلال فترة العمل</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                
                                <li contenteditable="false" class="mb-1">
                                    <span>المسمى الوظيفي السابق</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>اسم الشركة السابقة</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>2018 - 2020</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>وصف المهام والمسؤوليات الرئيسية</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>المشاريع والإنجازات البارزة</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                                <li contenteditable="false" class="mb-1">
                                    <span>المهارات المكتسبة خلال فترة العمل</span>
                                    <i class="fas fa-times delete-btn"></i>
                                </li>
                            </ul>
                            <button class="add-item-btn experience-add-btn"><i class="fas fa-plus ml-1"></i> إضافة نقطة</button>
                        </div>
                    </div>
                </div>
                
                <!-- قسم الأقسام المخصصة الجديدة -->
                <div id="customSectionsContainer"></div>
                
                <!-- زر إضافة قسم جديد -->
                <div class="section-buttons no-print">
                    <button id="addSectionBtn" class="add-section-btn">
                        <i class="fas fa-plus-circle ml-1"></i> إضافة قسم جديد
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- حوار إضافة قسم جديد -->
    <div id="addSectionModal" class="modal">
        <div class="modal-content">
            <div class="mb-4 text-center">
                <h3 class="text-xl font-bold mb-2">إضافة قسم جديد</h3>
                <p class="text-gray-600">أدخل عنوان القسم الجديد</p>
            </div>
            
            <div class="mb-4">
                <input id="newSectionTitle" type="text" placeholder="عنوان القسم" class="w-full p-2 border border-gray-300 rounded text-right" />
            </div>
            
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="columnSelect">
                    مكان ظهور القسم
                </label>
                <select id="columnSelect" class="w-full p-2 border border-gray-300 rounded text-right">
                    <option value="right">العمود الأيمن</option>
                    <option value="left">العمود الأيسر</option>
                    <option value="full">عرض كامل (أسفل الأعمدة)</option>
                </select>
            </div>
            
            <div class="flex justify-between">
                <button id="cancelAddSection" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded">
                    إلغاء
                </button>
                <button id="confirmAddSection" class="bg-primary-custom hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                    إضافة
                </button>
            </div>
        </div>
    </div>
    
    <!-- مؤشر الحالة -->
    <div id="pdfLoader" class="loader"></div>
    <div id="downloadStatus" class="text-center text-green-600 font-semibold py-2 hidden no-print"></div>
    
    <!-- نافذة إدخال النص بالكامل -->
    <div id="bulkTextModal" class="modal">
        <div class="modal-content">
            <div class="mb-4 text-center">
                <h3 class="text-xl font-bold mb-2">إدخال النص بالكامل</h3>
                <p class="text-gray-600 mb-4">قم بلصق نص السيرة الذاتية بالكامل هنا وسيقوم النظام بتحليله وترتيبه تلقائياً:</p>
            </div>
            
            <textarea id="bulkTextInput" class="w-full h-80 p-3 border rounded-md text-base dark:bg-gray-700 dark:border-gray-600 dark:text-white" dir="rtl" placeholder="الصق نص السيرة الذاتية هنا..."></textarea>
            
            <div class="mt-4 flex justify-end">
                <button id="cancelBulkBtn" class="bg-gray-300 dark:bg-gray-600 text-gray-800 dark:text-white px-4 py-2 rounded-md hover:bg-gray-400 dark:hover:bg-gray-500 transition ml-2">
                    إلغاء
                </button>
                <button id="parseBulkBtn" class="bg-primary-custom text-white px-4 py-2 rounded-md hover:bg-opacity-90 transition">
                    تحليل وتطبيق
                </button>
            </div>
        </div>
    </div>
    
    <!-- قسم لصق النص متعدد الأسطر -->
    <div id="multilinePasteModal" class="modal">
        <div class="modal-content">
            <div class="mb-4 text-center">
                <h3 class="text-xl font-bold mb-2">لصق نص متعدد الأسطر</h3>
                <p class="text-gray-600 mb-2">الصق النص هنا وسيتم تحويله إلى نقاط بشكل تلقائي</p>
            </div>
            
            <textarea id="multilinePasteTextarea" placeholder="الصق النص هنا..." class="w-full h-40 p-3 border border-gray-300 rounded text-right focus:outline-none focus:ring-2 focus:ring-primary-custom focus:border-transparent"></textarea>
            
            <div class="mb-4 mt-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="targetSection">
                    القسم المستهدف
                </label>
                <select id="targetSection" class="w-full p-2 border border-gray-300 rounded text-right">
                    <!-- سيتم ملؤه ديناميكياً بالأقسام المتاحة -->
                </select>
            </div>
            
            <div class="flex justify-between mt-4">
                <button id="cancelMultilinePaste" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded">
                    إلغاء
                </button>
                <button id="confirmMultilinePaste" class="bg-primary-custom hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                    إضافة كنقاط
                </button>
            </div>
        </div>
    </div>
    
    <!-- زر لصق متعدد الأسطر -->
    <button id="pasteMultilineBtn" class="paste-multiline-btn">
        <i class="fas fa-paste"></i>
    </button>
    
    <!-- رسالة التحديد المتعدد -->
    <div id="multiSelectTooltip" class="multi-select-tooltip">
        اضغط على CTRL للتحديد المتعدد وتحرير عدة نقاط معاً
    </div>
    
    <!-- زر نسخ النقاط المحددة -->
    <button id="copySelectedBtn" class="copy-selected-btn">
        <i class="fas fa-copy ml-1"></i> نسخ النقاط المحددة
    </button>
    
    <!-- أزرار إجراءات التحديد المتعدد -->
    <div class="multi-selection-controls">
        <div class="text-sm mb-2">التحديد المتعدد: <span id="selectionCount">0</span> عنصر</div>
        <div class="selection-actions">
            <button id="copyMultipleBtn" class="selection-action-btn">
                <i class="fas fa-copy ml-1"></i> نسخ
            </button>
            <button id="deleteMultipleBtn" class="selection-action-btn delete">
                <i class="fas fa-trash ml-1"></i> حذف
            </button>
        </div>
    </div>
    
    <!-- الشاشة المعتمة للنوافذ -->
    <div id="overlay" class="overlay"></div>

    <!-- نافذة تأكيد الحذف للنقر الطويل -->
    <div id="deleteConfirmModal" class="delete-confirm-modal">
        <div class="delete-confirm-content">
            <div class="mb-4">
                <i class="fas fa-exclamation-triangle text-yellow-500 text-3xl mb-2"></i>
                <h3 class="text-lg font-bold">تأكيد الحذف</h3>
                <p class="text-gray-600 mt-2">هل أنت متأكد من حذف هذا العنصر؟</p>
            </div>
            <div class="delete-confirm-buttons">
                <button id="deleteConfirmBtn" class="delete-confirm-btn confirm">
                    <i class="fas fa-trash-alt ml-1"></i> حذف
                </button>
                <button id="deleteCancelBtn" class="delete-confirm-btn cancel">
                    إلغاء
                </button>
            </div>
        </div>
    </div>

    <script>
        // إضافة دعم مكتبة jsPDF
        window.jsPDF = window.jspdf.jsPDF;
        
        document.addEventListener('DOMContentLoaded', function() {
            const toggleEditBtn = document.getElementById('toggleEditBtn');
            const generatePdfBtn = document.getElementById('generatePdfBtn');
            const colorSettingsBtn = document.getElementById('colorSettingsBtn');
            const colorPickerPanel = document.getElementById('colorPickerPanel');
            const fontSettingsBtn = document.getElementById('fontSettingsBtn');
            const fontPickerPanel = document.getElementById('fontPickerPanel');
            const bulletStyleBtn = document.getElementById('bulletStyleBtn');
            const bulletPickerPanel = document.getElementById('bulletPickerPanel');
            const customizeLayoutBtn = document.getElementById('customizeLayoutBtn');
            const customTemplatesPanel = document.getElementById('customTemplatesPanel');
            const closeTemplatesBtn = document.getElementById('closeTemplatesBtn');
            const applyCustomTemplate = document.getElementById('applyCustomTemplate');
            const primaryColorOptions = document.querySelectorAll('#primaryColorOptions .color-option');
            const customPrimaryColorPicker = document.getElementById('customPrimaryColorPicker');
            const backgroundColorOptions = document.querySelectorAll('#backgroundColorOptions .color-option');
            const customBackgroundColorPicker = document.getElementById('customBackgroundColorPicker');
            const bulletOptions = document.querySelectorAll('.bullet-option');
            const resumeContent = document.getElementById('resumeContent');
            const customSectionsContainer = document.getElementById('customSectionsContainer');
            const rightColumn = document.getElementById('rightColumn');
            const leftColumn = document.getElementById('leftColumn');
            const addSectionBtn = document.getElementById('addSectionBtn');
            const addSectionModal = document.getElementById('addSectionModal');
            const newSectionTitle = document.getElementById('newSectionTitle');
            const columnSelect = document.getElementById('columnSelect');
            const cancelAddSection = document.getElementById('cancelAddSection');
            const confirmAddSection = document.getElementById('confirmAddSection');
            const pdfLoader = document.getElementById('pdfLoader');
            const downloadStatus = document.getElementById('downloadStatus');
            const dragHint = document.getElementById('dragHint');
            const multilinePasteModal = document.getElementById('multilinePasteModal');
            const multilinePasteTextarea = document.getElementById('multilinePasteTextarea');
            const targetSection = document.getElementById('targetSection');
            const confirmMultilinePaste = document.getElementById('confirmMultilinePaste');
            const cancelMultilinePaste = document.getElementById('cancelMultilinePaste');
            const pasteMultilineBtn = document.getElementById('pasteMultilineBtn');
            const multiSelectTooltip = document.getElementById('multiSelectTooltip');
            const copySelectedBtn = document.getElementById('copySelectedBtn');
            const overlay = document.getElementById('overlay');
            const designItems = document.querySelectorAll('.design-item');
            const designCategories = document.querySelectorAll('.design-category');
            const multiSelectionControls = document.querySelector('.multi-selection-controls');
            const selectionCount = document.getElementById('selectionCount');
            const copyMultipleBtn = document.getElementById('copyMultipleBtn');
            const deleteMultipleBtn = document.getElementById('deleteMultipleBtn');
            const mainContent = document.getElementById('mainContent');
            const bulkTextBtn = document.getElementById('bulkTextBtn'); 
            const bulkTextModal = document.getElementById('bulkTextModal');
            const bulkTextInput = document.getElementById('bulkTextInput');
            const parseBulkBtn = document.getElementById('parseBulkBtn');
            const cancelBulkBtn = document.getElementById('cancelBulkBtn');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const deleteConfirmModal = document.getElementById('deleteConfirmModal');
            const deleteConfirmBtn = document.getElementById('deleteConfirmBtn');
            const deleteCancelBtn = document.getElementById('deleteCancelBtn');
            
            let isEditMode = false;
            let sectionCounter = 1; // عداد للأقسام الجديدة
            let draggedSection = null; // القسم الذي يتم سحبه حالياً
            let currentTemplate = 'ats-standard'; // النموذج الافتراضي
            let selectedCustomTemplate = ''; // النموذج المخصص المحدد
            let selectedItems = []; // مصفوفة للعناصر المحددة
            let isCtrlPressed = false; // مؤشر لحالة مفتاح Ctrl
            let isTemplatesPanelVisible = false; // مؤشر لحالة قائمة التصاميم
            let currentBulletType = 'normal'; // نوع النقطة الافتراضي
            let itemToDelete = null; // العنصر المراد حذفه
            let longPressTimer = null; // مؤقت للنقر الطويل
            
            // تعيين المتغيرات الأساسية للألوان بداية
            document.documentElement.style.setProperty('--primary-color', '#5D5CDE');
            document.documentElement.style.setProperty('--primary-rgb', '93,92,222');
            document.documentElement.style.setProperty('--background-color', '#FFFFFF');
            document.documentElement.style.setProperty('--text-color', '#1F2937');
            document.documentElement.style.setProperty('--border-color', '#E5E7EB');
            document.documentElement.style.setProperty('--bullet-type', '•'); // النقطة الافتراضية
            
            // متغيرات لحفظ ترتيب الأقسام
            let sectionOrder = loadSectionOrder() || {
                right: ['objective', 'education', 'courses', 'skills'],
                left: ['contact', 'experience'],
                full: []
            };

            // إعداد وظيفة النقر الطويل على النقاط
            function setupLongPressDelete() {
                // إزالة معالجات الحدث القديمة للنقرات لمنع التكرار
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.removeEventListener('click', handleDeleteButtonClick);
                    btn.addEventListener('click', handleDeleteButtonClick);
                });

                // إعداد معالجات النقر الطويل على عناصر القائمة
                document.querySelectorAll('.custom-list li').forEach(listItem => {
                    listItem.removeEventListener('contextmenu', handleContextMenu);
                    listItem.removeEventListener('mousedown', handleMouseDown);
                    listItem.removeEventListener('mouseup', handleMouseUp);
                    listItem.removeEventListener('mouseleave', handleMouseLeave);
                    listItem.removeEventListener('touchstart', handleTouchStart);
                    listItem.removeEventListener('touchend', handleTouchEnd);
                    listItem.removeEventListener('touchcancel', handleTouchCancel);

                    listItem.addEventListener('contextmenu', handleContextMenu);
                    listItem.addEventListener('mousedown', handleMouseDown);
                    listItem.addEventListener('mouseup', handleMouseUp);
                    listItem.addEventListener('mouseleave', handleMouseLeave);
                    listItem.addEventListener('touchstart', handleTouchStart);
                    listItem.addEventListener('touchend', handleTouchEnd);
                    listItem.addEventListener('touchcancel', handleTouchCancel);
                });
            }

            // منع الإجراء الافتراضي للنقر بزر الفأرة الأيمن
            function handleContextMenu(e) {
                if (isEditMode) {
                    e.preventDefault();
                }
            }

            // معالجة حدث الضغط على الفأرة
            function handleMouseDown(e) {
                if (isEditMode && e.button === 0) { // زر الفأرة الأيسر فقط
                    startLongPress(this);
                }
            }

            // معالجة حدث رفع الفأرة
            function handleMouseUp() {
                clearLongPress();
            }

            // معالجة حدث مغادرة الفأرة للعنصر
            function handleMouseLeave() {
                clearLongPress();
            }

            // معالجة حدث بدء اللمس (للأجهزة اللوحية والهواتف)
            function handleTouchStart(e) {
                if (isEditMode) {
                    // منع التمرير عند النقر الطويل
                    e.preventDefault();
                    startLongPress(this);
                }
            }

            // معالجة حدث انتهاء اللمس
            function handleTouchEnd() {
                clearLongPress();
            }

            // معالجة حدث إلغاء اللمس
            function handleTouchCancel() {
                clearLongPress();
            }

            // معالجة النقر على زر الحذف
            function handleDeleteButtonClick(e) {
                if (isEditMode) {
                    const listItem = this.closest('li');
                    showDeleteConfirmation(listItem);
                    e.stopPropagation();
                }
            }

            // بدء مؤقت النقر الطويل
            function startLongPress(element) {
                clearLongPress(); // تأكد من عدم وجود مؤقت نشط
                
                longPressTimer = setTimeout(() => {
                    if (isEditMode) {
                        showDeleteConfirmation(element);
                    }
                }, 500); // تأخير 500 مللي ثانية للنقر الطويل
            }

            // مسح مؤقت النقر الطويل
            function clearLongPress() {
                if (longPressTimer) {
                    clearTimeout(longPressTimer);
                    longPressTimer = null;
                }
            }

            // عرض مربع حوار تأكيد الحذف
            function showDeleteConfirmation(element) {
                itemToDelete = element;
                deleteConfirmModal.classList.add('active');
                overlay.style.display = 'block';
            }

            // تأكيد حذف العنصر
            deleteConfirmBtn.addEventListener('click', function() {
                if (itemToDelete) {
                    itemToDelete.style.transition = 'all 0.2s';
                    itemToDelete.style.opacity = '0';
                    itemToDelete.style.transform = 'translateX(10px)';
                    
                    setTimeout(() => {
                        itemToDelete.remove();
                        itemToDelete = null;
                    }, 200);
                }
                closeDeleteConfirmation();
            });

            // إلغاء حذف العنصر
            deleteCancelBtn.addEventListener('click', function() {
                closeDeleteConfirmation();
            });

            // إغلاق مربع حوار تأكيد الحذف
            function closeDeleteConfirmation() {
                deleteConfirmModal.classList.remove('active');
                overlay.style.display = 'none';
                itemToDelete = null;
            }
            
            // مستمع أحداث لزر تغيير شكل النقاط
            bulletStyleBtn.addEventListener('click', function() {
                // إخفاء اللوحات الأخرى
                colorPickerPanel.classList.add('hidden');
                fontPickerPanel.classList.add('hidden');
                
                // إظهار أو إخفاء لوحة اختيار شكل النقاط
                bulletPickerPanel.classList.toggle('hidden');
            });
            
            // مستمعي أحداث لخيارات شكل النقاط
            bulletOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // إزالة الفئة النشطة من جميع الخيارات
                    bulletOptions.forEach(opt => opt.classList.remove('active'));
                    
                    // إضافة الفئة النشطة للخيار المحدد
                    this.classList.add('active');
                    
                    // تطبيق نوع النقطة المحدد
                    const bulletType = this.getAttribute('data-bullet-type');
                    changeBulletType(bulletType);
                });
            });
            
            // تغيير نوع النقطة
            function changeBulletType(bulletType) {
                // إزالة جميع فئات النقاط السابقة
                resumeContent.classList.forEach(className => {
                    if (className.startsWith('bullet-type-')) {
                        resumeContent.classList.remove(className);
                    }
                });
                
                // إضافة فئة النقطة الجديدة
                resumeContent.classList.add(`bullet-type-${bulletType}`);
                
                // تحديث النقطة الحالية
                currentBulletType = bulletType;
                
                // حفظ نوع النقطة المحدد في التخزين المحلي
                localStorage.setItem('resumeBulletType', bulletType);
                
                // تحديث متغير CSS للنقطة
                updateBulletTypeVariable(bulletType);
                
                // إظهار رسالة تأكيد
                showDownloadStatus('تم تغيير شكل النقاط بنجاح', true);
            }
            
            // تحديث متغير CSS لنوع النقطة
            function updateBulletTypeVariable(bulletType) {
                let bulletSymbol = '•'; // النقطة الافتراضية
                
                switch (bulletType) {
                    case 'normal': bulletSymbol = '•'; break;
                    case 'diamond': bulletSymbol = '◆'; break;
                    case 'triangle': bulletSymbol = '►'; break;
                    case 'check': bulletSymbol = '✓'; break;
                    case 'star': bulletSymbol = '✦'; break;
                    case 'square': bulletSymbol = '■'; break;
                    case 'circle': bulletSymbol = '◉'; break;
                    case 'arrow': bulletSymbol = '➤'; break;
                    case 'dash': bulletSymbol = '--'; break;
                    case 'plus': bulletSymbol = '+'; break;
                    case 'heart': bulletSymbol = '♥'; break;
                    case 'rarrow': bulletSymbol = '❯'; break;
                    default: bulletSymbol = '•';
                }
                
                document.documentElement.style.setProperty('--bullet-type', `"${bulletSymbol}"`);
            }
            
            // إغلاق قائمة التصاميم
            closeTemplatesBtn.addEventListener('click', function() {
                customTemplatesPanel.style.display = 'none';
                mainContent.classList.remove('content-shifted');
                isTemplatesPanelVisible = false;
            });
            
            // فتح قائمة التصاميم عند النقر على زر اختر التصميم
            customizeLayoutBtn.addEventListener('click', function() {
                if (!isTemplatesPanelVisible) {
                    customTemplatesPanel.style.display = 'block';
                    mainContent.classList.add('content-shifted');
                    isTemplatesPanelVisible = true;
                } else {
                    customTemplatesPanel.style.display = 'none';
                    mainContent.classList.remove('content-shifted');
                    isTemplatesPanelVisible = false;
                }
                
                // إخفاء اللوحات الأخرى
                colorPickerPanel.classList.add('hidden');
                fontPickerPanel.classList.add('hidden');
                bulletPickerPanel.classList.add('hidden');
            });
            
            // تصفية التصاميم حسب الفئة
            designCategories.forEach(category => {
                category.addEventListener('click', function() {
                    const selectedCategory = this.dataset.category;
                    
                    // تحديث تنشيط الفئة
                    designCategories.forEach(cat => cat.classList.remove('active'));
                    this.classList.add('active');
                    
                    // إظهار أو إخفاء التصاميم حسب الفئة
                    designItems.forEach(item => {
                        if (selectedCategory === 'all') {
                            item.style.display = 'block';
                        } else {
                            const categories = item.dataset.category.split(',');
                            if (categories.includes(selectedCategory)) {
                                item.style.display = 'block';
                            } else {
                                item.style.display = 'none';
                            }
                        }
                    });
                });
            });
            
            // اختيار التصميم من القائمة
            designItems.forEach(item => {
                item.addEventListener('click', function() {
                    designItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    selectedCustomTemplate = this.dataset.template;
                });
            });
            
            // إضافة مستمعي الأحداث لمفاتيح التحكم (CTRL) للتحديد المتعدد
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Control') {
                    isCtrlPressed = true;
                    
                    if (isEditMode) {
                        multiSelectTooltip.style.display = 'block';
                        
                        // إخفاء الرسالة بعد 3 ثوانِ
                        setTimeout(() => {
                            multiSelectTooltip.style.display = 'none';
                        }, 3000);
                    }
                }
            });
            
            document.addEventListener('keyup', function(e) {
                if (e.key === 'Control') {
                    isCtrlPressed = false;
                    multiSelectTooltip.style.display = 'none';
                }
            });
            
            // تحديث عدد العناصر المحددة
            function updateSelectionCount() {
                selectionCount.textContent = selectedItems.length;
                if (selectedItems.length > 0) {
                    multiSelectionControls.classList.add('active');
                    copySelectedBtn.style.display = 'block';
                    const lastParentList = selectedItems[selectedItems.length - 1].closest('ul');
                    lastParentList.after(copySelectedBtn);
                } else {
                    multiSelectionControls.classList.remove('active');
                    copySelectedBtn.style.display = 'none';
                }
            }
            
            // نسخ العناصر المتعددة المحددة
            copyMultipleBtn.addEventListener('click', function() {
                copySelectedItems();
            });
            
            // حذف العناصر المتعددة المحددة
            deleteMultipleBtn.addEventListener('click', function() {
                if (selectedItems.length === 0) return;
                
                const confirmDelete = confirm(`هل أنت متأكد من حذف ${selectedItems.length} عنصر؟`);
                if (confirmDelete) {
                    selectedItems.forEach(item => {
                        item.style.transition = 'all 0.2s';
                        item.style.opacity = '0';
                        item.style.transform = 'translateX(10px)';
                        
                        setTimeout(() => {
                            item.remove();
                        }, 200);
                    });
                    
                    selectedItems = [];
                    updateSelectionCount();
                    copySelectedBtn.style.display = 'none';
                }
            });
            
            // إضافة وظيفة التحديد المتعدد للعناصر
            function setupMultiSelectItems() {
                document.querySelectorAll('.custom-list li').forEach(item => {
                    item.addEventListener('click', function(e) {
                        if (!isEditMode) return;
                        
                        // إذا كان زر Ctrl مضغوطًا، أضف العنصر إلى التحديد المتعدد
                        if (isCtrlPressed) {
                            e.preventDefault();
                            e.stopPropagation();
                            
                            if (this.classList.contains('selected')) {
                                // إزالة من التحديد
                                this.classList.remove('selected');
                                selectedItems = selectedItems.filter(el => el !== this);
                            } else {
                                // إضافة إلى التحديد
                                this.classList.add('selected');
                                selectedItems.push(this);
                            }
                            
                            // تحديث عدد العناصر المحددة
                            updateSelectionCount();
                        }
                    });
                });
            }
            
            // نسخ العناصر المحددة
            function copySelectedItems() {
                if (selectedItems.length === 0) return;
                
                const copiedTexts = selectedItems.map(item => {
                    const span = item.querySelector('span');
                    return span ? span.textContent.trim() : '';
                }).filter(text => text !== '');
                
                if (copiedTexts.length > 0) {
                    const clipboard = copiedTexts.join('\n');
                    navigator.clipboard.writeText(clipboard)
                        .then(() => {
                            showDownloadStatus(`تم نسخ ${copiedTexts.length} عنصر بنجاح`, true);
                        })
                        .catch(err => {
                            console.error('فشل في نسخ النص: ', err);
                            showDownloadStatus('فشل في نسخ النص', false);
                        });
                }
            }
            
            // نسخ العناصر المحددة
            copySelectedBtn.addEventListener('click', copySelectedItems);
            
            // إضافة وظيفة النقر خارج العناصر المحددة
            document.addEventListener('click', function(e) {
                if (!isCtrlPressed && isEditMode && !e.target.closest('.custom-list li')) {
                    // إلغاء التحديد للعناصر
                    selectedItems.forEach(item => {
                        item.classList.remove('selected');
                    });
                    selectedItems = [];
                    updateSelectionCount();
                    copySelectedBtn.style.display = 'none';
                }
                
                // إغلاق لوحات منسدلة عند النقر خارجها
                if (!bulletStyleBtn.contains(e.target) && !bulletPickerPanel.contains(e.target)) {
                    bulletPickerPanel.classList.add('hidden');
                }
            });
            
            // إعداد وظيفة لصق النص متعدد الأسطر
            pasteMultilineBtn.addEventListener('click', function() {
                if (!isEditMode) return;
                
                // تحديث قائمة الأقسام المتاحة
                updateTargetSectionOptions();
                
                // إظهار النافذة
                multilinePasteModal.style.display = 'flex';
                overlay.style.display = 'block';
                multilinePasteTextarea.focus();
            });
            
            // تحديث خيارات الأقسام المستهدفة
            function updateTargetSectionOptions() {
                targetSection.innerHTML = '';
                
                // جمع جميع الأقسام المتاحة
                const sections = document.querySelectorAll('.draggable-section');
                
                sections.forEach(section => {
                    const header = section.querySelector('.section-header h2');
                    if (header) {
                        const title = header.textContent.trim();
                        const sectionId = section.getAttribute('data-section-id');
                        
                        const option = document.createElement('option');
                        option.value = sectionId;
                        option.textContent = title;
                        targetSection.appendChild(option);
                    }
                });
            }
            
            // إلغاء النافذة
            cancelMultilinePaste.addEventListener('click', function() {
                multilinePasteModal.style.display = 'none';
                overlay.style.display = 'none';
                multilinePasteTextarea.value = '';
            });
            
            // تأكيد لصق النص متعدد الأسطر
            confirmMultilinePaste.addEventListener('click', function() {
                const text = multilinePasteTextarea.value.trim();
                const sectionId = targetSection.value;
                
                if (text && sectionId) {
                    // تقسيم النص إلى أسطر
                    const lines = text.split('\n')
                        .map(line => line.trim())
                        .filter(line => line.length > 0);
                    
                    if (lines.length > 0) {
                        // الحصول على القائمة المستهدفة
                        const section = document.querySelector(`[data-section-id="${sectionId}"]`);
                        if (section) {
                            const targetList = section.querySelector('.custom-list');
                            
                            // إضافة كل سطر كعنصر جديد
                            lines.forEach(line => {
                                addNewListItem(targetList, line);
                            });
                            
                            // عرض رسالة نجاح
                            showDownloadStatus(`تم إضافة ${lines.length} نقطة بنجاح`, true);
                        }
                    }
                }
                
                // إغلاق النافذة
                multilinePasteModal.style.display = 'none';
                overlay.style.display = 'none';
                multilinePasteTextarea.value = '';
            });
            
            // إضافة عنصر جديد للقائمة
            function addNewListItem(targetList, textContent) {
                const newItem = document.createElement('li');
                newItem.setAttribute('contenteditable', isEditMode.toString());
                newItem.className = 'mb-1';
                
                const newSpan = document.createElement('span');
                newSpan.textContent = textContent;
                
                const deleteBtn = document.createElement('i');
                deleteBtn.className = 'fas fa-times delete-btn';
                deleteBtn.addEventListener('click', handleDeleteButtonClick);
                
                newItem.appendChild(newSpan);
                newItem.appendChild(deleteBtn);
                targetList.appendChild(newItem);
                
                // إعداد النقر الطويل وغيره من الوظائف
                setupLongPressDelete();
                
                // إعداد وظيفة التحديد المتعدد للعنصر الجديد
                newItem.addEventListener('click', function(e) {
                    if (!isEditMode) return;
                    
                    if (isCtrlPressed) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        if (this.classList.contains('selected')) {
                            this.classList.remove('selected');
                            selectedItems = selectedItems.filter(el => el !== this);
                        } else {
                            this.classList.add('selected');
                            selectedItems.push(this);
                        }
                        
                        updateSelectionCount();
                    }
                });
            }
            
            // تغيير نوع الخط
            function changeFont(fontFamily) {
                document.documentElement.style.setProperty('--font-family', fontFamily);
                
                // تطبيق الخط على كل العناصر الرئيسية
                document.body.style.fontFamily = fontFamily;
                
                // حفظ الخط المحدد للاستخدام لاحقًا
                localStorage.setItem('resumeFont', fontFamily);
            }
            
            // تغيير حجم الخط
            function changeFontSize(sizeFactor) {
                // تحديث حجم الخط الأساسي
                document.documentElement.style.setProperty('--font-size-base', `${sizeFactor}rem`);
                document.documentElement.style.setProperty('--font-size-header', `${sizeFactor * 2}rem`);
                document.documentElement.style.setProperty('--font-size-title', `${sizeFactor * 1.25}rem`);
                document.documentElement.style.setProperty('--font-size-subtitle', `${sizeFactor * 1.1}rem`);
                
                // حفظ حجم الخط المحدد للاستخدام لاحقًا
                localStorage.setItem('resumeFontSize', sizeFactor);
            }
            
            // إضافة مستمع لزر إعدادات الخط
            fontSettingsBtn.addEventListener('click', function() {
                // إخفاء اللوحات الأخرى
                colorPickerPanel.classList.add('hidden');
                bulletPickerPanel.classList.add('hidden');
                
                // إظهار أو إخفاء لوحة إعدادات الخط
                fontPickerPanel.classList.toggle('hidden');
            });
            
            // تطبيق النموذج المخصص المحدد
            applyCustomTemplate.addEventListener('click', function() {
                if (selectedCustomTemplate) {
                    // تبديل النموذج
                    changeTemplate(selectedCustomTemplate);
                    
                    // إخفاء لوحة التخصيص (اختياري هنا حسب التصميم الجديد)
                    // customTemplatesPanel.style.display = 'none';
                    // mainContent.classList.remove('content-shifted');
                    // isTemplatesPanelVisible = false;
                    
                    // إظهار رسالة تأكيد للمستخدم
                    showDownloadStatus('تم تطبيق التصميم بنجاح', true);
                } else {
                    // رسالة للمستخدم في حالة عدم اختيار نموذج
                    alert('الرجاء اختيار تصميم أولاً.');
                }
            });
            
            // تغيير النموذج
            function changeTemplate(templateName) {
                // إزالة الفئات السابقة
                resumeContent.classList.forEach(className => {
                    if (className.startsWith('template-')) {
                        resumeContent.classList.remove(className);
                    }
                });
                
                // إضافة فئة النموذج الجديد
                resumeContent.classList.add(`template-${templateName}`);
                
                // تحديث النموذج الحالي
                currentTemplate = templateName;
                
                // حفظ النموذج المحدد في التخزين المحلي
                localStorage.setItem('resumeTemplate', templateName);
                
                // تحديث العنصر النشط في قائمة التصاميم
                designItems.forEach(item => {
                    if (item.getAttribute('data-template') === templateName) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });

                // إضافة تأثير انتقالي على المحتوى
                resumeContent.style.opacity = '0';
                resumeContent.style.transition = 'opacity 0.3s ease-in-out';
                
                setTimeout(() => {
                    resumeContent.style.opacity = '1';
                }, 50);
            }
            
            // تحديث مصفوفة ترتيب الأقسام
            function updateSectionOrder() {
                sectionOrder = {
                    right: [],
                    left: [],
                    full: []
                };
                
                // جمع الأقسام من العمود الأيمن
                rightColumn.querySelectorAll('.draggable-section').forEach(section => {
                    sectionOrder.right.push(section.dataset.sectionId);
                });
                
                // جمع الأقسام من العمود الأيسر
                leftColumn.querySelectorAll('.draggable-section').forEach(section => {
                    sectionOrder.left.push(section.dataset.sectionId);
                });
                
                // جمع الأقسام من العرض الكامل
                customSectionsContainer.querySelectorAll('.draggable-section').forEach(section => {
                    sectionOrder.full.push(section.dataset.sectionId);
                });
                
                // حفظ الترتيب الجديد
                saveSectionOrder(sectionOrder);
            }
            
            // حفظ ترتيب الأقسام في التخزين المحلي
            function saveSectionOrder(order) {
                localStorage.setItem('resumeSectionOrder', JSON.stringify(order));
            }
            
            // استرجاع ترتيب الأقسام من التخزين المحلي
            function loadSectionOrder() {
                const savedOrder = localStorage.getItem('resumeSectionOrder');
                return savedOrder ? JSON.parse(savedOrder) : null;
            }
            
            // إعداد وظائف السحب والإفلات
            function setupDragAndDrop() {
                const draggableSections = document.querySelectorAll('.draggable-section');
                const dropTargets = [rightColumn, leftColumn, customSectionsContainer];
                
                draggableSections.forEach(section => {
                    // مقبض السحب
                    const dragHandle = section.querySelector('.section-drag-handle');
                    
                    // تفعيل السحب فقط عند النقر على مقبض السحب
                    dragHandle.addEventListener('mousedown', function(e) {
                        if (isEditMode) {
                            section.setAttribute('draggable', 'true');
                        }
                    });
                    
                    // إضافة تأثير عند بدء السحب
                    section.addEventListener('dragstart', function(e) {
                        if (!isEditMode) return;
                        
                        draggedSection = section;
                        setTimeout(() => {
                            section.classList.add('dragging');
                        }, 0);
                        
                        // تخزين معرف القسم في بيانات النقل
                        e.dataTransfer.setData('text/plain', section.getAttribute('data-section-id'));
                        e.dataTransfer.effectAllowed = 'move';
                    });
                    
                    // إزالة تأثير السحب عند انتهاء العملية
                    section.addEventListener('dragend', function(e) {
                        if (!isEditMode) return;
                        
                        section.classList.remove('dragging');
                        section.setAttribute('draggable', 'false');
                        draggedSection = null;
                        
                        // تحديث ترتيب الأقسام بعد السحب
                        updateSectionOrder();
                        
                        // إزالة مؤشرات الإسقاط
                        document.querySelectorAll('.drop-indicator').forEach(indicator => {
                            indicator.remove();
                        });
                    });
                });
                
                // إضافة مستمعي أحداث للمناطق المستهدفة
                dropTargets.forEach(target => {
                    // عند دخول العنصر إلى منطقة الإسقاط
                    target.addEventListener('dragover', function(e) {
                        if (!isEditMode || !draggedSection) return;
                        
                        e.preventDefault();
                        e.dataTransfer.dropEffect = 'move';
                        
                        // تحديد الموضع الذي سيتم إسقاط العنصر فيه
                        const closestSection = getClosestSection(e.clientY, target);
                        
                        // إزالة مؤشرات الإسقاط السابقة
                        document.querySelectorAll('.drop-indicator').forEach(indicator => {
                            indicator.remove();
                        });
                        
                        // إنشاء وإظهار مؤشر الإسقاط في المكان المناسب
                        const indicator = document.createElement('div');
                        indicator.className = 'drop-indicator';
                        indicator.style.display = 'block';
                        
                        if (closestSection) {
                            target.insertBefore(indicator, closestSection);
                        } else {
                            target.appendChild(indicator);
                        }
                    });
                    
                    // عند مغادرة منطقة الإسقاط
                    target.addEventListener('dragleave', function(e) {
                        if (!isEditMode) return;
                        
                        // إزالة مؤشرات الإسقاط إذا تم مغادرة المنطقة المستهدفة
                        if (!target.contains(e.relatedTarget)) {
                            document.querySelectorAll('.drop-indicator').forEach(indicator => {
                                indicator.remove();
                            });
                        }
                    });
                    
                    // عند الإسقاط
                    target.addEventListener('drop', function(e) {
                        if (!isEditMode || !draggedSection) return;
                        
                        e.preventDefault();
                        
                        // تحديد الموضع الذي سيتم إدراج العنصر فيه
                        const closestSection = getClosestSection(e.clientY, target);
                        
                        // الإضافة في الموضع المناسب
                        if (closestSection) {
                            target.insertBefore(draggedSection, closestSection);
                        } else {
                            target.appendChild(draggedSection);
                        }
                        
                        // إزالة مؤشرات الإسقاط
                        document.querySelectorAll('.drop-indicator').forEach(indicator => {
                            indicator.remove();
                        });
                        
                        // تحديث ترتيب الأقسام
                        updateSectionOrder();
                    });
                });
            }
            
            // العثور على القسم الأقرب لموقع المؤشر
            function getClosestSection(clientY, container) {
                const sections = Array.from(container.querySelectorAll('.draggable-section:not(.dragging)'));
                
                if (sections.length === 0) return null;
                
                let closestSection = null;
                let closestDistance = Number.POSITIVE_INFINITY;
                
                sections.forEach(section => {
                    const box = section.getBoundingClientRect();
                    const boxCenter = box.top + box.height / 2;
                    const distance = Math.abs(clientY - boxCenter);
                    
                    if (distance < closestDistance) {
                        closestDistance = distance;
                        closestSection = section;
                    }
                });
                
                // تحديد ما إذا كان يجب وضع العنصر قبل أو بعد العنصر الأقرب
                if (closestSection) {
                    const box = closestSection.getBoundingClientRect();
                    const boxCenter = box.top + box.height / 2;
                    
                    if (clientY < boxCenter) {
                        return closestSection; // وضع العنصر قبل العنصر الأقرب
                    } else {
                        return closestSection.nextElementSibling; // وضع العنصر بعد العنصر الأقرب
                    }
                }
                
                return null;
            }
            
            // إعداد مستمعي أحداث لحذف الأقسام
            function setupSectionDeleteButtons() {
                document.querySelectorAll('.section-delete-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        if (isEditMode) {
                            const sectionHeader = this.closest('.section-header');
                            const section = sectionHeader.closest('.draggable-section');
                            
                            if (confirm('هل أنت متأكد من رغبتك في حذف هذا القسم؟')) {
                                // إضافة تأثير متحرك عند الحذف
                                section.style.transition = 'all 0.3s';
                                section.style.opacity = '0';
                                section.style.transform = 'translateY(-10px)';
                                
                                setTimeout(() => {
                                    section.remove();
                                    // تحديث ترتيب الأقسام بعد الحذف
                                    updateSectionOrder();
                                }, 300);
                            }
                            
                            e.stopPropagation();
                        }
                    });
                });
            }
            
            // فتح وإغلاق لوحة الألوان
            colorSettingsBtn.addEventListener('click', function() {
                // إخفاء اللوحات الأخرى
                fontPickerPanel.classList.add('hidden');
                bulletPickerPanel.classList.add('hidden');
                
                // إظهار أو إخفاء لوحة الألوان
                colorPickerPanel.classList.toggle('hidden');
            });
            
            // فتح حوار إضافة قسم جديد
            addSectionBtn.addEventListener('click', function() {
                if (isEditMode) {
                    addSectionModal.style.display = 'flex';
                    overlay.style.display = 'block';
                    newSectionTitle.focus();
                }
            });
            
            // إغلاق حوار إضافة قسم جديد
            cancelAddSection.addEventListener('click', function() {
                addSectionModal.style.display = 'none';
                overlay.style.display = 'none';
                newSectionTitle.value = '';
            });
            
            // عند النقر خارج الحوارات
            window.addEventListener('click', function(e) {
                if (e.target === addSectionModal) {
                    addSectionModal.style.display = 'none';
                    overlay.style.display = 'none';
                    newSectionTitle.value = '';
                }
                
                if (e.target === multilinePasteModal) {
                    multilinePasteModal.style.display = 'none';
                    overlay.style.display = 'none';
                    multilinePasteTextarea.value = '';
                }
                
                if (e.target === bulkTextModal) {
                    bulkTextModal.style.display = 'none';
                    overlay.style.display = 'none';
                    bulkTextInput.value = '';
                }
                
                if (e.target === overlay) {
                    addSectionModal.style.display = 'none';
                    multilinePasteModal.style.display = 'none';
                    bulkTextModal.style.display = 'none';
                    deleteConfirmModal.classList.remove('active');
                    overlay.style.display = 'none';
                }
                
                if (!colorSettingsBtn.contains(e.target) && !colorPickerPanel.contains(e.target)) {
                    colorPickerPanel.classList.add('hidden');
                }
                
                if (!fontSettingsBtn.contains(e.target) && !fontPickerPanel.contains(e.target)) {
                    fontPickerPanel.classList.add('hidden');
                }
            });
            
            // إنشاء قسم جديد
            confirmAddSection.addEventListener('click', function() {
                const title = newSectionTitle.value.trim();
                const column = columnSelect.value;
                
                if (title) {
                    const sectionId = `custom-section-${sectionCounter}`;
                    const listId = `custom-list-${sectionCounter}`;
                    
                    // إنشاء عنصر القسم الجديد
                    const newSection = document.createElement('div');
                    newSection.className = 'border-t border-custom pt-6 mb-8 draggable-section';
                    newSection.setAttribute('draggable', 'false');
                    newSection.setAttribute('data-section-id', sectionId);
                    newSection.id = sectionId;
                    
                    newSection.innerHTML = `
                        <div class="section-header flex items-center">
                            <i class="fas fa-grip-lines section-drag-handle" title="اسحب لتغيير الموضع"></i>
                            <h2 class="text-xl font-bold mb-4 text-primary-custom" contenteditable="${isEditMode}">${title}</h2>
                            <i class="fas fa-trash-alt section-delete-btn"></i>
                        </div>
                        <ul class="custom-list ${listId}"></ul>
                        <button class="add-item-btn ${sectionId}-add-btn"><i class="fas fa-plus ml-1"></i> إضافة نقطة</button>
                    `;
                    
                    // إضافة القسم الجديد إلى المكان المناسب
                    let targetContainer;
                    
                    if (column === 'right') {
                        targetContainer = rightColumn;
                        sectionOrder.right.push(sectionId);
                    } else if (column === 'left') {
                        targetContainer = leftColumn;
                        sectionOrder.left.push(sectionId);
                    } else { // full
                        targetContainer = customSectionsContainer;
                        sectionOrder.full.push(sectionId);
                    }
                    
                    targetContainer.appendChild(newSection);
                    
                    // حفظ ترتيب الأقسام الجديد
                    saveSectionOrder(sectionOrder);
                    
                    // إضافة مستمع أحداث لزر إضافة نقطة
                    const addBtn = newSection.querySelector(`.${sectionId}-add-btn`);
                    addBtn.addEventListener('click', function() {
                        if (isEditMode) {
                            const targetList = newSection.querySelector('.custom-list');
                            
                            // إنشاء عنصر جديد
                            const newItem = document.createElement('li');
                            newItem.setAttribute('contenteditable', 'true');
                            newItem.className = 'mb-1';
                            
                            const newSpan = document.createElement('span');
                            newSpan.textContent = 'أدخل النص هنا';
                            
                            const deleteBtn = document.createElement('i');
                            deleteBtn.className = 'fas fa-times delete-btn';
                            deleteBtn.addEventListener('click', handleDeleteButtonClick);
                            
                            newItem.appendChild(newSpan);
                            newItem.appendChild(deleteBtn);
                            targetList.appendChild(newItem);
                            
                            // ضبط التركيز على العنصر الجديد
                            setTimeout(() => {
                                const range = document.createRange();
                                const sel = window.getSelection();
                                range.selectNodeContents(newSpan);
                                sel.removeAllRanges();
                                sel.addRange(range);
                            }, 0);
                            
                            // إعداد وظيفة التحديد المتعدد للعنصر الجديد
                            setupMultiSelectItems();
                            
                            // إعداد وظيفة النقر الطويل
                            setupLongPressDelete();
                        }
                    });
                    
                    // إضافة مستمع حدث لزر حذف القسم
                    const deleteBtn = newSection.querySelector('.section-delete-btn');
                    deleteBtn.addEventListener('click', function(e) {
                        if (isEditMode) {
                            if (confirm('هل أنت متأكد من رغبتك في حذف هذا القسم؟')) {
                                newSection.style.transition = 'all 0.3s';
                                newSection.style.opacity = '0';
                                newSection.style.transform = 'translateY(-10px)';
                                
                                setTimeout(() => {
                                    newSection.remove();
                                    // تحديث ترتيب الأقسام بعد الحذف
                                    updateSectionOrder();
                                }, 300);
                            }
                            
                            e.stopPropagation();
                        }
                    });
                    
                    // إعداد وظائف السحب والإفلات للقسم الجديد
                    const dragHandle = newSection.querySelector('.section-drag-handle');
                    
                    dragHandle.addEventListener('mousedown', function(e) {
                        if (isEditMode) {
                            newSection.setAttribute('draggable', 'true');
                        }
                    });
                    
                    newSection.addEventListener('dragstart', function(e) {
                        if (!isEditMode) return;
                        
                        draggedSection = newSection;
                        setTimeout(() => {
                            newSection.classList.add('dragging');
                        }, 0);
                        
                        e.dataTransfer.setData('text/plain', newSection.getAttribute('data-section-id'));
                        e.dataTransfer.effectAllowed = 'move';
                    });
                    
                    newSection.addEventListener('dragend', function(e) {
                        if (!isEditMode) return;
                        
                        newSection.classList.remove('dragging');
                        newSection.setAttribute('draggable', 'false');
                        draggedSection = null;
                        
                        // تحديث ترتيب الأقسام بعد السحب
                        updateSectionOrder();
                        
                        // إزالة مؤشرات الإسقاط
                        document.querySelectorAll('.drop-indicator').forEach(indicator => {
                            indicator.remove();
                        });
                    });
                    
                    sectionCounter++;
                    addSectionModal.style.display = 'none';
                    overlay.style.display = 'none';
                    newSectionTitle.value = '';
                    
                    // عرض رسالة تأكيد
                    showDownloadStatus('تم إضافة القسم الجديد بنجاح', true);
                } else {
                    alert('الرجاء إدخال عنوان للقسم الجديد');
                }
            });
            
            // إضافة عنصر جديد عند النقر على زر الإضافة
            document.addEventListener('click', function(e) {
                if (isEditMode && e.target.classList.contains('add-item-btn') || e.target.parentElement.classList.contains('add-item-btn')) {
                    const btn = e.target.classList.contains('add-item-btn') ? e.target : e.target.parentElement;
                    const classList = Array.from(btn.classList);
                    const prefix = classList.find(cls => cls.endsWith('-add-btn')).replace('-add-btn', '');
                    
                    // تحديد القائمة المستهدفة (إما بالفئة المحددة أو أقرب قائمة)
                    let targetList;
                    if (prefix.startsWith('custom-section')) {
                        // للأقسام المخصصة، ابحث عن أقرب قائمة
                        targetList = btn.closest('.draggable-section').querySelector('.custom-list');
                    } else {
                        // للأقسام الافتراضية، استخدم الفئة المحددة
                        targetList = document.querySelector('.' + prefix + '-list');
                    }
                    
                    if (!targetList) return;
                    
                    // إنشاء عنصر جديد
                    const newItem = document.createElement('li');
                    newItem.setAttribute('contenteditable', 'true');
                    newItem.className = 'mb-1';
                    
                    const newSpan = document.createElement('span');
                    newSpan.textContent = 'أدخل النص هنا';
                    
                    const deleteBtn = document.createElement('i');
                    deleteBtn.className = 'fas fa-times delete-btn';
                    deleteBtn.addEventListener('click', handleDeleteButtonClick);
                    
                    newItem.appendChild(newSpan);
                    newItem.appendChild(deleteBtn);
                    targetList.appendChild(newItem);
                    
                    // ضبط التركيز على العنصر الجديد للتحرير المباشر
                    setTimeout(() => {
                        const range = document.createRange();
                        const sel = window.getSelection();
                        range.selectNodeContents(newSpan);
                        sel.removeAllRanges();
                        sel.addRange(range);
                    }, 0);
                    
                    // إعداد وظيفة التحديد المتعدد للعنصر الجديد
                    setupMultiSelectItems();
                    
                    // إعداد وظيفة النقر الطويل
                    setupLongPressDelete();
                }
            });
            
            // دالة لعرض رسالة حالة الحفظ
            function showDownloadStatus(message, isSuccess = true) {
                downloadStatus.textContent = message;
                downloadStatus.className = isSuccess ? 
                    'text-center text-green-600 font-semibold py-2 no-print' : 
                    'text-center text-red-600 font-semibold py-2 no-print';
                downloadStatus.classList.remove('hidden');
                
                setTimeout(() => {
                    downloadStatus.classList.add('hidden');
                }, 3000);
            }
            
            // تحسين إنشاء وحفظ ملف PDF
            generatePdfBtn.addEventListener('click', async function() {
                // عرض حالة التحميل
                pdfLoader.style.display = 'block';
                
                try {
                    // إخفاء أزرار الحذف والإضافة مؤقتًا قبل إنشاء PDF
                    const deleteButtons = document.querySelectorAll('.delete-btn, .section-delete-btn');
                    const addButtons = document.querySelectorAll('.add-item-btn, .add-section-btn');
                    const dragHandles = document.querySelectorAll('.section-drag-handle');
                    
                    deleteButtons.forEach(btn => btn.style.display = 'none');
                    addButtons.forEach(btn => btn.style.display = 'none');
                    dragHandles.forEach(handle => handle.style.display = 'none');
                    
                    // تعطيل وضع التحرير مؤقتًا
                    const contentEditables = document.querySelectorAll('[contenteditable="true"]');
                    contentEditables.forEach(el => {
                        el.setAttribute('data-previous', "true");
                        el.setAttribute('contenteditable', "false");
                        el.style.border = 'none';
                    });
                    
                    // إزالة فئة وضع التحرير مؤقتًا
                    const wasInEditMode = resumeContent.classList.contains('edit-mode');
                    if (wasInEditMode) {
                        resumeContent.classList.remove('edit-mode');
                    }
                    
                    // تأكيد إعدادات الاسم وضمان عدم عكسه
                    const nameElement = document.getElementById('personName');
                    nameElement.style.textAlign = 'center';
                    nameElement.style.direction = 'rtl';
                    nameElement.style.unicodeBidi = 'embed';
                    
                    // قياس حجم المحتوى وحساب نسبة التصغير
                    const contentHeight = resumeContent.scrollHeight;
                    const a4HeightInPx = 1123; // تقريبًا 297 ملم بدقة 96 نقطة في البوصة
                    const originalWidth = resumeContent.offsetWidth;
                    let scale = 1;
                    
                    // تطبيق التصغير حسب حجم المحتوى
                    if (contentHeight > a4HeightInPx) {
                        scale = Math.min(0.9, a4HeightInPx / contentHeight);
                    }
                    
                    // إنشاء نسخة من المحتوى للتصوير
                    const tempContainer = document.createElement('div');
                    tempContainer.style.position = 'absolute';
                    tempContainer.style.left = '-9999px';
                    tempContainer.style.width = `${originalWidth}px`;
                    tempContainer.style.direction = 'rtl';
                    document.body.appendChild(tempContainer);
                    
                    // نسخ المحتوى إلى الحاوية المؤقتة
                    const clone = resumeContent.cloneNode(true);
                    tempContainer.appendChild(clone);
                    
                    // تصحيح اتجاه النص في النسخة
                    const cloneNameElement = clone.querySelector('#personName');
                    if (cloneNameElement) {
                        cloneNameElement.style.textAlign = 'center';
                        cloneNameElement.style.direction = 'rtl';
                        cloneNameElement.style.unicodeBidi = 'embed';
                        cloneNameElement.style.transform = 'none';
                        cloneNameElement.style.position = 'relative';
                        cloneNameElement.style.width = '100%';
                    }
                    
                    // تطبيق التصغير على المحتوى المؤقت
                    if (scale < 1) {
                        clone.style.transformOrigin = 'top right';
                        clone.style.transform = `scale(${scale})`;
                    }

                    // تعطيل أي تحول قد يؤثر على عناصر العنوان
                    clone.querySelectorAll('.section-header h2').forEach(header => {
                        header.style.transform = 'none';
                        header.style.direction = 'rtl';
                        header.style.unicodeBidi = 'embed';
                    });

                    // تأكيد أن محتوى الملف PDF سيظهر بشكل صحيح
                    clone.style.direction = 'rtl';
                    clone.style.textAlign = 'right';
                    
                    // تنفيذ تصوير المحتوى بعد تطبيق التنسيقات بوقت كافي
                    setTimeout(async () => {
                        try {
                            // التقاط صورة للمحتوى باستخدام html2canvas مع إعدادات محسنة
                            const canvas = await html2canvas(clone, {
                                scale: 4, // زيادة الدقة لتحسين جودة الخط (من 3 إلى 4)
                                useCORS: true,
                                logging: false,
                                allowTaint: true,
                                backgroundColor: document.documentElement.style.getPropertyValue('--background-color'),
                                onclone: (clonedDoc) => {
                                    // تطبيق إصلاحات إضافية على النسخة المستنسخة
                                    const clonedName = clonedDoc.getElementById('personName');
                                    if (clonedName) {
                                        clonedName.style.textAlign = 'center';
                                        clonedName.style.direction = 'rtl';
                                        clonedName.style.unicodeBidi = 'embed';
                                        clonedName.style.transform = 'none';
                                    }
                                }
                            });
                            
                            // إنشاء ملف PDF باستخدام jsPDF مع إعدادات محسنة
                            const pdf = new jsPDF({
                                orientation: 'portrait',
                                unit: 'mm',
                                format: 'a4',
                                compress: true
                            });

// تحديد أبعاد صفحة A4
const pageWidth = pdf.internal.pageSize.getWidth();
const pageHeight = pdf.internal.pageSize.getHeight();

// حساب نسبة العرض للارتفاع في القماش
const canvasRatio = canvas.width / canvas.height;

// تقليل قياسات الصورة
let imgWidth = pageWidth * 0.95; // تقليل العرض بنسبة 5%
let imgHeight = imgWidth / canvasRatio;

// ضبط الصورة لتناسب ارتفاع الصفحة
if (imgHeight > pageHeight * 0.95) {
    imgHeight = pageHeight * 0.95;
    imgWidth = imgHeight * canvasRatio;
}

// ضبط موضع الصورة لتكون في المنتصف تمامًا
const xPosition = (pageWidth - imgWidth) / 2;
const yPosition = (pageHeight - imgHeight) / 2;

// إضافة الصورة إلى PDF بجودة عالية
const imgData = canvas.toDataURL('image/png', 1.0);
pdf.addImage(imgData, 'PNG', xPosition, yPosition, imgWidth, imgHeight, undefined, 'FAST');

// تفعيل الدعم الكامل للغة العربية إذا كان متاحًا
if (pdf.setR2L) {
    pdf.setR2L(true);
}

// حفظ الملف
pdf.save('سيرتي_الذاتية.pdf');
                            
                            // إزالة الحاوية المؤقتة
                            document.body.removeChild(tempContainer);
                            
                            // إعادة العناصر لوضعها السابق
                            deleteButtons.forEach(btn => btn.style.display = '');
                            addButtons.forEach(btn => btn.style.display = '');
                            dragHandles.forEach(handle => handle.style.display = '');
                            
                            contentEditables.forEach(el => {
                                if (el.getAttribute('data-previous') === "true") {
                                    el.setAttribute('contenteditable', "true");
                                    el.removeAttribute('data-previous');
                                    el.style.border = '1px dashed var(--primary-color)';
                                }
                            });
                            
                            // إعادة فئة وضع التحرير إذا كانت مفعلة
                            if (wasInEditMode) {
                                resumeContent.classList.add('edit-mode');
                            }
                            
                            // إخفاء حالة التحميل وعرض رسالة النجاح
                            pdfLoader.style.display = 'none';
                            showDownloadStatus('تم حفظ ملف PDF بنجاح في مجلد التنزيلات', true);
                        } catch (err) {
                            throw err;
                        }
                    }, 800); // زيادة وقت الانتظار لضمان تطبيق جميع التنسيقات
                    
                } catch (err) {
                    console.error('خطأ في إنشاء PDF:', err);
                    
                    // إعادة العناصر لوضعها الأصلي في حالة الخطأ
                    document.querySelectorAll('.delete-btn, .section-delete-btn').forEach(btn => btn.style.display = '');
                    document.querySelectorAll('.add-item-btn, .add-section-btn').forEach(btn => btn.style.display = '');
                    document.querySelectorAll('.section-drag-handle').forEach(handle => handle.style.display = '');
                    
                    document.querySelectorAll('[contenteditable="true"]').forEach(el => {
                        el.setAttribute('contenteditable', "true");
                        el.style.border = '1px dashed var(--primary-color)';
                    });
                    
                    if (resumeContent.classList.contains('edit-mode')) {
                        resumeContent.classList.add('edit-mode');
                    }
                    
                    // إخفاء حالة التحميل وعرض رسالة الخطأ
                    pdfLoader.style.display = 'none';
                    showDownloadStatus('حدث خطأ أثناء إنشاء ملف PDF. يرجى المحاولة مرة أخرى.', false);
                }
            });
            
            // إعداد وظيفة إدخال النص الكامل
            bulkTextBtn.addEventListener('click', function() {
                bulkTextModal.style.display = 'flex';
                overlay.style.display = 'block';
                bulkTextInput.focus();
            });
            
            // إلغاء نافذة إدخال النص الكامل
            cancelBulkBtn.addEventListener('click', closeModal);
            
            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', closeModal);
            }
            
            // إغلاق نافذة إدخال النص الكامل
            function closeModal() {
                bulkTextModal.style.display = 'none';
                overlay.style.display = 'none';
                bulkTextInput.value = '';
            }
            
            // تحليل وتطبيق النص الكامل
            parseBulkBtn.addEventListener('click', function() {
                const bulkText = bulkTextInput.value.trim();
                if (!bulkText) {
                    alert('يرجى إدخال نص السيرة الذاتية');
                    return;
                }
                
                // تحليل النص وتطبيقه
                parseBulkText(bulkText);
                closeModal();
                showDownloadStatus('تم تحليل النص وتطبيقه بنجاح', true);
            });
            
            // دالة تحليل النص الكامل - محسنة
            function parseBulkText(text) {
                // تهيئة كائن لتخزين البيانات المحللة
                const data = {
                    personalInfo: {},
                    objective: [],
                    education: [],
                    experience: [],
                    skills: [],
                    courses: [],
                    contact: []
                };
                
                // تقسيم النص إلى أسطر
                const lines = text.split('\n').map(line => line.trim()).filter(line => line);
                
                let currentSection = null;
                let currentItems = [];
                
                // تحسين قائمة أنماط التعرف على العناوين الرئيسية
                const sectionPatterns = {
                    objective: [
                        /^الهدف (المهني|الوظيفي)/i,
                        /^الهدف/i,
                        /^ملخص/i,
                        /^نبذة/i,
                        /^المستهدف/i,
                        /^الهدف من السيرة/i,
                        /^الرؤية/i
                    ],
                    education: [
                        /^التعليم/i,
                        /^المؤهلات/i,
                        /^الشهادات/i,
                        /^المؤهلات العلمية/i,
                        /^المسار التعليمي/i,
                        /^الشهادات العلمية/i
                    ],
                    experience: [
                        /^الخبرات/i,
                        /^الخبرة/i,
                        /^الوظائف/i,
                        /^التاريخ المهني/i,
                        /^السجل المهني/i,
                        /^الخبرة العملية/i
                    ],
                    skills: [
                        /^المهارات/i,
                        /^مهارات/i,
                        /^الكفاءات/i,
                        /^المهارات والقدرات/i,
                        /^القدرات/i
                    ],
                    courses: [
                        /^الدورات/i,
                        /^دورات/i,
                        /^التدريب/i,
                        /^الشهادات التدريبية/i,
                        /^الدورات التدريبية/i
                    ],
                    contact: [
                        /^معلومات (شخصية|الاتصال)/i,
                        /^التواصل/i,
                        /^الاتصال/i,
                        /^البيانات الشخصية/i,
                        /^بيانات الاتصال/i
                    ]
                };
                
                // تحديد القسم بناءً على النص
                function detectSection(line) {
                    for (const [section, patterns] of Object.entries(sectionPatterns)) {
                        for (const pattern of patterns) {
                            if (pattern.test(line)) {
                                return section;
                            }
                        }
                    }
                    return null;
                }
                
                // تحديد الأقسام من خلال أنماط شائعة
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    
                    // اكتشاف القسم الجديد
                    const detectedSection = detectSection(line);
                    
                    if (detectedSection) {
                        // حفظ البيانات من القسم السابق
                        if (currentSection && currentItems.length > 0) {
                            data[currentSection] = [...data[currentSection], ...currentItems];
                        }
                        // الانتقال للقسم الجديد
                        currentSection = detectedSection;
                        currentItems = [];
                    } 
                    else if (i === 0 && !currentSection) {
                        // العنصر الأول قد يكون الاسم
                        data.personalInfo.name = line;
                    }
                    else if (currentSection) {
                        // معالجة معلومات الاتصال بشكل خاص
                        if (currentSection === 'contact') {
                            if (line.includes('البريد') || line.includes('@')) {
                                // البحث عن بريد إلكتروني
                                const emailMatch = line.match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9_-]+)/);
                                if (emailMatch) {
                                    const formattedLine = `<i class="fas fa-envelope text-primary-custom ml-2"></i> ${emailMatch[0]}`;
                                    currentItems.push(formattedLine);
                                } else {
                                    currentItems.push(line);
                                }
                            } 
                            else if (line.includes('هاتف') || line.match(/\d{10}/) || line.includes('جوال')) {
                                // البحث عن رقم هاتف
                                const phoneMatch = line.match(/(\d[\d\s-]+\d)/);
                                if (phoneMatch) {
                                    const formattedLine = `<i class="fas fa-phone text-primary-custom ml-2"></i> ${phoneMatch[0]}`;
                                    currentItems.push(formattedLine);
                                } else {
                                    currentItems.push(line);
                                }
                            } 
                            else if (line.includes('عنوان') || line.includes('مدينة') || line.includes('المدينة')) {
                                // معلومات العنوان
                                const formattedLine = `<i class="fas fa-map-marker-alt text-primary-custom ml-2"></i> ${line.replace(/عنوان[:]?\s*/i, '')}`;
                                currentItems.push(formattedLine);
                            } 
                            else if (line.includes('هوية') || line.includes('رقم الهوية') || line.includes('الرقم الوطني')) {
                                // معلومات الهوية
                                const formattedLine = `<i class="fas fa-id-card text-primary-custom ml-2"></i> ${line}`;
                                currentItems.push(formattedLine);
                            }
                            else if (line.includes('ميلاد') || line.includes('تاريخ الميلاد') || line.includes('المواليد')) {
                                // تاريخ الميلاد
                                const formattedLine = `<i class="fas fa-birthday-cake text-primary-custom ml-2"></i> ${line}`;
                                currentItems.push(formattedLine);
                            }
                            else {
                                currentItems.push(line);
                            }
                        } else {
                            // أنواع أخرى من الأسطر لأقسام أخرى
                            currentItems.push(line);
                        }
                    }
                }
                
                // إضافة القسم الأخير
                if (currentSection && currentItems.length > 0) {
                    data[currentSection] = [...data[currentSection], ...currentItems];
                }
                
                // تحديث القالب بالبيانات المحللة
                updateCVWithParsedData(data);
            }
            
            // تحديث CV بالبيانات المحللة
            function updateCVWithParsedData(data) {
                // تحديث الاسم إذا وجد
                if (data.personalInfo.name) {
                    const nameElement = document.getElementById('personName');
                    if (nameElement) {
                        nameElement.textContent = data.personalInfo.name;
                    }
                }
                
                // دالة مساعدة لتحديث القوائم
                function updateSection(sectionId, items) {
                    if (!items || items.length === 0) return;
                    
                    const section = document.getElementById(sectionId);
                    if (!section) return;
                    
                    const list = section.querySelector('.custom-list');
                    if (!list) return;
                    
                    // تنظيف القائمة الموجودة
                    list.innerHTML = '';
                    
                    // إضافة عناصر جديدة
                    items.forEach(item => {
                        const li = document.createElement('li');
                        li.className = 'mb-1';
                        li.setAttribute('contenteditable', isEditMode.toString());
                        
                        // إذا كان العنصر يحتوي على تنسيق HTML (مثل الأيقونات)
                        if (item.includes('<i class="fas')) {
                            const span = document.createElement('span');
                            span.innerHTML = item;
                            
                            const deleteBtn = document.createElement('i');
                            deleteBtn.className = 'fas fa-times delete-btn';
                            deleteBtn.addEventListener('click', handleDeleteButtonClick);
                            
                            li.appendChild(span);
                            li.appendChild(deleteBtn);
                        } else {
                            const span = document.createElement('span');
                            span.textContent = item;
                            
                            const deleteBtn = document.createElement('i');
                            deleteBtn.className = 'fas fa-times delete-btn';
                            deleteBtn.addEventListener('click', handleDeleteButtonClick);
                            
                            li.appendChild(span);
                            li.appendChild(deleteBtn);
                        }
                        
                        list.appendChild(li);
                    });
                    
                    // إعداد وظيفة تحديد متعدد للعناصر الجديدة
                    setupMultiSelectItems();
                    
                    // إعداد وظيفة النقر الطويل للحذف
                    setupLongPressDelete();
                }
                
                // تحديث كل قسم
                updateSection('objective-section', data.objective);
                updateSection('education-section', data.education);
                updateSection('experience-section', data.experience);
                updateSection('skills-section', data.skills);
                updateSection('courses-section', data.courses);
                updateSection('contact-section', data.contact);
            }
            
            // تهيئة دعم العناصر المحددة متعددة
            setupMultiSelectItems();
            
            // إعداد أزرار الحذف الأولية
            setupLongPressDelete();
            setupSectionDeleteButtons();
            
            // إعداد وظائف السحب والإفلات
            setupDragAndDrop();
            
            // تطبيق قيم الألوان المخزنة
            const savedPrimaryColor = localStorage.getItem('resumePrimaryColor');
            const savedPrimaryColorRgb = localStorage.getItem('resumePrimaryColorRgb');
            if (savedPrimaryColor && savedPrimaryColorRgb) {
                changePrimaryColor(savedPrimaryColor, savedPrimaryColorRgb);
                setActivePrimaryColorOption(savedPrimaryColor);
            }
            
            const savedBackgroundColor = localStorage.getItem('resumeBackgroundColor');
            const savedTextColor = localStorage.getItem('resumeTextColor');
            const savedBorderColor = localStorage.getItem('resumeBorderColor');
            if (savedBackgroundColor && savedTextColor && savedBorderColor) {
                document.documentElement.style.setProperty('--background-color', savedBackgroundColor);
                document.documentElement.style.setProperty('--text-color', savedTextColor);
                document.documentElement.style.setProperty('--border-color', savedBorderColor);
                setActiveBackgroundColorOption(savedBackgroundColor);
            }
            
            // تطبيق النموذج المحفوظ
            const savedTemplate = localStorage.getItem('resumeTemplate');
            if (savedTemplate) {
                changeTemplate(savedTemplate);
                
                // تحديث العنصر النشط في قائمة التصاميم
                designItems.forEach(item => {
                    if (item.getAttribute('data-template') === savedTemplate) {
                        item.classList.add('active');
                        selectedCustomTemplate = savedTemplate;
                    }
                });
            }
            
            // تطبيق نوع الخط المحفوظ
            const savedFont = localStorage.getItem('resumeFont');
            if (savedFont) {
                changeFont(savedFont);
                
                // تحديث العنصر النشط في قائمة الخطوط
                document.querySelectorAll('.font-option').forEach(option => {
                    if (option.getAttribute('data-font') === savedFont) {
                        option.classList.add('active');
                    } else {
                        option.classList.remove('active');
                    }
                });
            }
            
            // تطبيق حجم الخط المحفوظ
            const savedFontSize = localStorage.getItem('resumeFontSize');
            if (savedFontSize) {
                changeFontSize(parseFloat(savedFontSize));
                
                // تحديث العنصر النشط في قائمة أحجام الخطوط
                document.querySelectorAll('.font-size-btn').forEach(btn => {
                    if (btn.getAttribute('data-size-factor') === savedFontSize) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }
            
            // تطبيق نوع النقطة المحفوظ
            const savedBulletType = localStorage.getItem('resumeBulletType');
            if (savedBulletType) {
                changeBulletType(savedBulletType);
                setActiveBulletOption(savedBulletType);
            }
            
            // إضافة مستمعي أحداث لخيارات الخط
            document.querySelectorAll('.font-option').forEach(option => {
                option.addEventListener('click', function() {
                    const font = this.getAttribute('data-font');
                    
                    // إزالة الكلاس النشط من جميع الخيارات
                    document.querySelectorAll('.font-option').forEach(opt => opt.classList.remove('active'));
                    
                    // إضافة الكلاس النشط للخيار المحدد
                    this.classList.add('active');
                    
                    // تطبيق الخط
                    changeFont(font);
                });
            });
            
            // إضافة مستمعي أحداث لأزرار حجم الخط
            document.querySelectorAll('.font-size-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const sizeFactor = parseFloat(this.getAttribute('data-size-factor'));
                    
                    // إزالة الكلاس النشط من جميع الأزرار
                    document.querySelectorAll('.font-size-btn').forEach(b => b.classList.remove('active'));
                    
                    // إضافة الكلاس النشط للزر المحدد
                    this.classList.add('active');
                    
                    // تطبيق حجم الخط
                    changeFontSize(sizeFactor);
                });
            });
            
            // إضافة مستمع لمفتاح Escape لإغلاق الحوارات المفتوحة
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    addSectionModal.style.display = 'none';
                    multilinePasteModal.style.display = 'none';
                    bulkTextModal.style.display = 'none';
                    deleteConfirmModal.classList.remove('active');
                    overlay.style.display = 'none';
                    colorPickerPanel.classList.add('hidden');
                    fontPickerPanel.classList.add('hidden');
                    bulletPickerPanel.classList.add('hidden');
                    multiSelectTooltip.style.display = 'none';
                    
                    if (isTemplatesPanelVisible) {
                        customTemplatesPanel.style.display = 'none';
                        mainContent.classList.remove('content-shifted');
                        isTemplatesPanelVisible = false;
                    }
                }
            });
            
            // دعم الوضع الداكن (إذا كان مدعوماً من المتصفح)
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            });
            
            // تحديد خيار اللون النشط
            function setActivePrimaryColorOption(selectedColor) {
                primaryColorOptions.forEach(option => {
                    if (option.getAttribute('data-color') === selectedColor) {
                        option.classList.add('active');
                    } else {
                        option.classList.remove('active');
                    }
                });
            }
            
            // تحديد خيار لون الخلفية النشط
            function setActiveBackgroundColorOption(selectedColor) {
                backgroundColorOptions.forEach(option => {
                    if (option.getAttribute('data-color') === selectedColor) {
                        option.classList.add('active');
                    } else {
                        option.classList.remove('active');
                    }
                });
            }

            // تحديد خيار شكل النقطة النشط
            function setActiveBulletOption(bulletType) {
                bulletOptions.forEach(option => {
                    if (option.getAttribute('data-bullet-type') === bulletType) {
                        option.classList.add('active');
                    } else {
                        option.classList.remove('active');
                    }
                });
            }
            
            // إضافة المستمعين لخيارات اللون الرئيسي
            primaryColorOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const color = this.getAttribute('data-color');
                    const rgb = this.getAttribute('data-rgb');
                    changePrimaryColor(color, rgb);
                    setActivePrimaryColorOption(color);
                });
            });
            
            // إضافة المستمعين لخيارات لون الخلفية
            backgroundColorOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const color = this.getAttribute('data-color');
                    const rgb = this.getAttribute('data-rgb');
                    changeBackgroundColor(color, rgb);
                    setActiveBackgroundColorOption(color);
                });
            });
            
            // استجابة لمنتقي الألوان الرئيسي المخصص
            customPrimaryColorPicker.addEventListener('input', function(e) {
                const color = e.target.value;
                
                // تحويل HEX إلى RGB
                const r = parseInt(color.substr(1, 2), 16);
                const g = parseInt(color.substr(3, 2), 16);
                const b = parseInt(color.substr(5, 2), 16);
                const rgb = `${r},${g},${b}`;
                
                changePrimaryColor(color, rgb);
                primaryColorOptions.forEach(option => option.classList.remove('active'));
            });
            
            // استجابة لمنتقي لون الخلفية المخصص
            customBackgroundColorPicker.addEventListener('input', function(e) {
                const color = e.target.value;
                changeBackgroundColor(color);
                backgroundColorOptions.forEach(option => option.classList.remove('active'));
            });
            
            // تغيير لون التصميم الرئيسي
            function changePrimaryColor(color, rgb) {
                document.documentElement.style.setProperty('--primary-color', color);
                document.documentElement.style.setProperty('--primary-rgb', rgb);
                
                // حفظ اللون المحدد للاستخدام لاحقًا
                localStorage.setItem('resumePrimaryColor', color);
                localStorage.setItem('resumePrimaryColorRgb', rgb);
                
                // تحديث اللون المحدد في منتقي الألوان المخصص
                customPrimaryColorPicker.value = color;
            }
            
            // تغيير لون خلفية التصميم
            function changeBackgroundColor(color, rgb) {
                document.documentElement.style.setProperty('--background-color', color);
                
                // تحديد لون النص بناءً على لون الخلفية
                const textColor = isLightColor(color) ? '#1F2937' : '#F9FAFB';
                document.documentElement.style.setProperty('--text-color', textColor);
                
                // تحديد لون الحدود بناءً على لون الخلفية
                const borderColor = isLightColor(color) ? '#E5E7EB' : '#4B5563';
                document.documentElement.style.setProperty('--border-color', borderColor);
                
                // حفظ الألوان المحددة للاستخدام لاحقًا
                localStorage.setItem('resumeBackgroundColor', color);
                localStorage.setItem('resumeTextColor', textColor);
                localStorage.setItem('resumeBorderColor', borderColor);
                
                // تحديث اللون المحدد في منتقي الألوان المخصص
                customBackgroundColorPicker.value = color;
            }
            
            // التحقق مما إذا كان اللون فاتحًا أو داكنًا
            function isLightColor(color) {
                // تحويل لون HEX إلى قيم RGB
                const r = parseInt(color.substr(1, 2), 16);
                const g = parseInt(color.substr(3, 2), 16);
                const b = parseInt(color.substr(5, 2), 16);
                
                // حساب درجة السطوع
                const brightness = (r * 299 + g * 587 + b * 114) / 1000;
                
                // إذا كانت الدرجة أكبر من 128، فهذا يعني أن اللون فاتح
                return brightness > 128;
            }
            
            // تبديل وضع التحرير
            toggleEditBtn.addEventListener('click', function() {
                isEditMode = !isEditMode;
                
                // تعديل حالة القسم الرئيسي
                if (isEditMode) {
                    resumeContent.classList.add('edit-mode');
                    dragHint.classList.remove('hidden');
                } else {
                    resumeContent.classList.remove('edit-mode');
                    dragHint.classList.add('hidden');
                    
                    // إزالة التحديد المتعدد عند الخروج من وضع التحرير
                    selectedItems.forEach(item => {
                        item.classList.remove('selected');
                    });
                    selectedItems = [];
                    updateSelectionCount();
                    copySelectedBtn.style.display = 'none';
                    multiSelectTooltip.style.display = 'none';
                }
                
                // تعديل حالة العناصر القابلة للتحرير (بما في ذلك العناوين)
                document.querySelectorAll('[contenteditable]').forEach(element => {
                    element.setAttribute('contenteditable', isEditMode.toString());
                });
                
                // تحديث خاصية السحب للأقسام
                document.querySelectorAll('.draggable-section').forEach(section => {
                    section.setAttribute('draggable', 'false');
                });
                
                // تعديل نص الزر
                toggleEditBtn.innerHTML = isEditMode ? 
                    '<i class="fas fa-save"></i> حفظ التغييرات' : 
                    '<i class="fas fa-edit"></i> تحرير المحتوى';
                
                // تغيير لون الزر
                if (isEditMode) {
                    toggleEditBtn.classList.remove('button-edit');
                    toggleEditBtn.classList.add('bg-yellow-500', 'hover:bg-yellow-600');
                } else {
                    toggleEditBtn.classList.add('button-edit');
                    toggleEditBtn.classList.remove('bg-yellow-500', 'hover:bg-yellow-600');
                }
            });
            
            // إضافة نقطة جديدة عند الضغط على مفتاح Enter
            document.addEventListener('keydown', function(e) {
                if (isEditMode && e.key === 'Enter' && !e.shiftKey) {
                    const selection = window.getSelection();
                    const node = selection.anchorNode;
                    
                    // التحقق مما إذا كان المؤشر داخل عنصر قائمة
                    const listItem = node.nodeType === 1 ? node.closest('li') : node.parentElement.closest('li');
                    if (listItem) {
                        e.preventDefault(); // منع السلوك الافتراضي للمتصفح
                        
                        // الحصول على القائمة الأم
                        const parentList = listItem.parentElement;
                        
                        // الحصول على العنصر الذي يحتوي على النص
                        const contentSpan = listItem.querySelector('span');
                        
                        // إنشاء عنصر قائمة جديد
                        const newItem = document.createElement('li');
                        newItem.className = listItem.className; // نسخ نفس فئة العنصر الحالي
                        newItem.setAttribute('contenteditable', 'true');
                        
                        // إنشاء محتوى جديد
                        const newSpan = document.createElement('span');
                        newSpan.textContent = '';
                        
                        // إنشاء زر حذف جديد
                        const deleteBtn = document.createElement('i');
                        deleteBtn.className = 'fas fa-times delete-btn';
                        deleteBtn.addEventListener('click', handleDeleteButtonClick);
                        
                        // إضافة العناصر إلى عنصر القائمة الجديد
                        newItem.appendChild(newSpan);
                        newItem.appendChild(deleteBtn);
                        
                        // إدراج العنصر الجديد بعد العنصر الحالي
                        if (listItem.nextSibling) {
                            parentList.insertBefore(newItem, listItem.nextSibling);
                        } else {
                            parentList.appendChild(newItem);
                        }
                        
                        // تعيين المؤشر داخل العنصر الجديد
                        const range = document.createRange();
                        range.selectNodeContents(newSpan);
                        selection.removeAllRanges();
                        selection.addRange(range);
                        
                        // إعداد وظيفة التحديد المتعدد للعنصر الجديد
                        setupMultiSelectItems();
                        
                        // إعداد وظيفة النقر الطويل للحذف
                        setupLongPressDelete();
                    }
                }
            });
            
            // معالجة لصق النص لتحويله إلى نقاط تلقائيًا
            document.addEventListener('paste', function(e) {
                if (!isEditMode) return;
                
                const target = e.target;
                if (target.contentEditable !== 'true' || !target.closest('li')) return;
                
                const clipboardData = e.clipboardData || window.clipboardData;
                const pastedText = clipboardData.getData('text');
                
                // تحقق مما إذا كان النص يحتوي على أسطر متعددة
                if (pastedText.includes('\n')) {
                    e.preventDefault();
                    
                    // استخراج الأسطر غير الفارغة
                    const lines = pastedText.split('\n')
                        .map(line => line.trim())
                        .filter(line => line.length > 0);
                    
                    if (lines.length > 0) {
                        // احصل على العنصر الحالي والقائمة الأم
                        const currentItem = target.closest('li');
                        const parentList = currentItem.parentElement;
                        
                        // استخدم السطر الأول لاستبدال محتوى العنصر الحالي
                        const currentSpan = currentItem.querySelector('span');
                        if (currentSpan) {
                            currentSpan.textContent = lines[0];
                        }
                        
                        // أضف بقية الأسطر كعناصر جديدة
                        if (lines.length > 1) {
                            // تحديد موضع الإدراج بعد العنصر الحالي
                            let insertAfter = currentItem;
                            
                            for (let i = 1; i < lines.length; i++) {
                                const newItem = document.createElement('li');
                                newItem.setAttribute('contenteditable', 'true');
                                newItem.className = currentItem.className;
                                
                                const newSpan = document.createElement('span');
                                newSpan.textContent = lines[i];
                                
                                const deleteBtn = document.createElement('i');
                                deleteBtn.className = 'fas fa-times delete-btn';
                                deleteBtn.addEventListener('click', handleDeleteButtonClick);
                                
                                newItem.appendChild(newSpan);
                                newItem.appendChild(deleteBtn);
                                
                                // إدراج بعد العنصر السابق
                                if (insertAfter.nextSibling) {
                                    parentList.insertBefore(newItem, insertAfter.nextSibling);
                                } else {
                                    parentList.appendChild(newItem);
                                }
                                
                                insertAfter = newItem;
                            }
                            
                            // إعداد التحديد المتعدد للعناصر الجديدة
                            setupMultiSelectItems();
                            
                            // إعداد وظيفة النقر الطويل للحذف
                            setupLongPressDelete();
                        }
                    }
                }
            });

            // أول مرة يتم تحميل الصفحة، إعداد كافة وظائف النقر الطويل
            setupLongPressDelete();
        });
    </script>
</body>
</html>